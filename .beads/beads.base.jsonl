{"id":"simultaneous_launch_button-0un","content_hash":"3cabe4bc232c1db2e8fbdc4397a1a286e51f020eb4ccf02d4905868f1c06ab09","title":"Implement quick reference card for slb with no arguments","description":"## Task\nImplement the beautiful lipgloss-styled quick reference card shown when running slb with no arguments.\n\n## Layout (from plan)\nBox drawing with rounded corners, Catppuccin Mocha colors:\n- Title: gradient mauve to blue\n- Commands: green (#a6e3a1)\n- Flags: yellow (#f9e2af)\n- Tier badges: ğŸ”´ red, ğŸŸ  orange, ğŸŸ¡ yellow\n\n## Features\n- Responsive: adjusts to terminal width (min 72, max 100)\n- ASCII fallback for terminals without Unicode\n- Shows SETUP, REQUESTOR, REVIEWER sections\n- Shows tier legend and key flags\n\n## Files\n- internal/cli/root.go\n\n## Acceptance Criteria\n- [ ] Card renders with lipgloss styling\n- [ ] Colors match Catppuccin Mocha\n- [ ] Responsive to terminal width\n- [ ] ASCII fallback works","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:47:32.923951078-06:00","updated_at":"2025-12-13T19:34:33.782152291-06:00","closed_at":"2025-12-13T19:34:33.782152291-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-0un","depends_on_id":"simultaneous_launch_button-v0z.2","type":"blocks","created_at":"2025-12-13T18:49:29.214422221-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-1c3","content_hash":"c3cd63bba07b536885265aead241dc7f4196a4aab87f75bd4838fcf67df4f488","title":"EPIC: Configuration System","description":"## Overview\nImplement the hierarchical configuration system using TOML.\n\n## Background \u0026 Rationale\nConfiguration flows from multiple sources with clear precedence:\n1. Built-in defaults (hardcoded sensible defaults)\n2. User config (~/.slb/config.toml)\n3. Project config (.slb/config.toml)\n4. Environment variables (SLB_*)\n5. Command-line flags (highest priority)\n\n## Configuration Sections (from plan)\n\n### [general]\n- min_approvals, require_different_model, different_model_timeout\n- conflict_resolution (any_rejection_blocks | first_wins | human_breaks_tie)\n- request_timeout, approval_ttl_minutes, approval_ttl_critical_minutes\n- timeout_action, enable_dry_run, enable_rollback_capture\n- cross_project_reviews, review_pool\n\n### [daemon]\n- use_file_watcher, ipc_socket, tcp_addr, tcp_require_auth, tcp_allowed_ips\n- log_level, pid_file\n\n### [rate_limits]\n- max_pending_per_session, max_requests_per_minute\n- rate_limit_action (reject | queue | warn)\n\n### [notifications]\n- desktop_enabled, desktop_delay_seconds\n- webhook_url, email_enabled\n\n### [history]\n- database_path, git_repo_path, retention_days, auto_git_commit\n\n### [patterns.critical/dangerous/caution/safe]\n- min_approvals, patterns array, dynamic_quorum settings\n\n### [integrations]\n- agent_mail_enabled, agent_mail_thread\n- claude_hooks_enabled\n\n### [agents]\n- trusted_self_approve, trusted_self_approve_delay_seconds\n- blocked agents list\n\n## Files\n- internal/config/config.go (struct definitions)\n- internal/config/defaults.go\n- internal/config/loader.go (TOML loading, hierarchy)\n- internal/config/patterns.go (pattern-specific config)\n- internal/cli/config.go\n\n## Success Criteria\n1. Config hierarchy works correctly\n2. Environment variables override file config\n3. CLI flags override everything\n4. Config validation catches invalid values\n5. `slb config` commands work","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-13T18:14:18.102283788-06:00","updated_at":"2025-12-13T18:14:18.102283788-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-1c3","depends_on_id":"simultaneous_launch_button-v0z","type":"blocks","created_at":"2025-12-13T18:14:18.10392258-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-1c3.1","content_hash":"ccb75f0478e0be622f5257b979ee4916c79e7af7dcf51c886dde6552786bcfc6","title":"Implement configuration loading and CLI commands","description":"## Task\nImplement the hierarchical configuration system with ALL sections from the plan.\n\n## Configuration Hierarchy (lowest to highest priority)\n1. Built-in defaults (hardcoded)\n2. User config (~/.slb/config.toml)\n3. Project config (.slb/config.toml)\n4. Environment variables (SLB_*)\n5. Command-line flags\n\n## Config Struct Sections (ALL from plan)\n\n### [general]\n- min_approvals (int, default 2)\n- require_different_model (bool, default false)\n- different_model_timeout (int, 300)\n- conflict_resolution (\"any_rejection_blocks\"|\"first_wins\"|\"human_breaks_tie\")\n- request_timeout (int, 1800)\n- approval_ttl_minutes (int, 30)\n- approval_ttl_critical_minutes (int, 10)\n- timeout_action (\"escalate\"|\"auto_reject\"|\"auto_approve_warn\")\n- enable_dry_run (bool, true)\n- enable_rollback_capture (bool, true)\n- max_rollback_size_mb (int, 100)\n- cross_project_reviews (bool, false)\n- review_pool ([]string)\n\n### [daemon]\n- use_file_watcher (bool, true)\n- ipc_socket (string)\n- tcp_addr (string, empty)\n- tcp_require_auth (bool, true)\n- tcp_allowed_ips ([]string)\n- log_level (string, \"info\")\n- pid_file (string)\n\n### [rate_limits]\n- max_pending_per_session (int, 5)\n- max_requests_per_minute (int, 10)\n- rate_limit_action (\"reject\"|\"queue\"|\"warn\")\n\n### [notifications]\n- desktop_enabled (bool, true)\n- desktop_delay_seconds (int, 60)\n- webhook_url (string)\n- email_enabled (bool, false)\n\n### [history]\n- database_path (string)\n- git_repo_path (string)\n- retention_days (int, 365)\n- auto_git_commit (bool, true)\n\n### [patterns.critical/dangerous/caution/safe]\n- min_approvals (int)\n- dynamic_quorum (bool)\n- dynamic_quorum_floor (int)\n- auto_approve_delay_seconds (int)\n- patterns ([]string)\n\n### [integrations]\n- agent_mail_enabled (bool, true)\n- agent_mail_thread (string, \"SLB-Reviews\")\n- claude_hooks_enabled (bool, true)\n\n### [agents]\n- trusted_self_approve ([]string)\n- trusted_self_approve_delay_seconds (int, 300)\n- blocked ([]string)\n\n## CLI Commands\n- slb config â†’ show current effective config\n- slb config get \u003ckey\u003e â†’ get specific value\n- slb config set \u003ckey\u003e \u003cvalue\u003e â†’ set in project config\n- slb config edit â†’ open in $EDITOR\n- slb config --global â†’ operate on user config\n\n## Files\n- internal/config/config.go\n- internal/config/defaults.go\n- internal/config/loader.go\n- internal/config/validation.go\n- internal/cli/config.go\n\n## Acceptance Criteria\n- [ ] All config sections implemented\n- [ ] Hierarchy works correctly\n- [ ] Env var override works\n- [ ] CLI flags override everything\n- [ ] Validation catches invalid values","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-13T18:27:52.756209905-06:00","updated_at":"2025-12-13T20:15:03.633146068-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-1c3.1","depends_on_id":"simultaneous_launch_button-v0z.1","type":"blocks","created_at":"2025-12-13T18:27:52.757367451-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-2t9","content_hash":"07b35ca114d28cd772000e17a12e42fc2280b6d4e6bed7557ffc00158ef90fd0","title":"EPIC: TUI Dashboard (Human Interface)","description":"## Overview\nImplement the beautiful TUI dashboard using Charmbracelet ecosystem - the ONLY interactive human interface.\n\n## Background \u0026 Rationale\nHumans need a visual interface to:\n- Monitor multiple agents and pending requests\n- Review and approve/reject commands\n- Search history\n- Manage configuration\n- Handle escalations\n\nThe TUI is NOT for agents. Agents use the CLI with --json.\n\n## Key Views (from plan)\n\n### Dashboard View (Main)\n- Left panel: Active agents with status indicators\n- Center panel: Pending requests with risk tier badges\n- Right panel: Recent activity\n- Bottom bar: Stats (24h approved, rejected, avg response time)\n\n### Request Detail View\n- Command display with syntax highlighting\n- Risk tier and status badges\n- Requestor info (agent, program, model)\n- Full justification (reason, effect, goal, safety)\n- Dry-run output (if available)\n- Attachments list\n- Reviews list\n- Action buttons: Approve, Reject, Copy command\n\n### History Browser View\n- Filters: status, agent, date range\n- FTS search across command, reason, etc.\n- Paginated results table\n- Click-through to detail view\n\n### Pattern Removal Review\n- Pending pattern removal requests\n- Human can approve/reject\n\n## Visual Design (from plan)\n- Catppuccin color themes (mocha, macchiato, latte, nord)\n- Nerd Font icons with Unicode/ASCII fallbacks\n- Consistent color coding: ğŸ”´ CRITICAL, ğŸŸ  DANGEROUS, ğŸŸ¡ CAUTION, ğŸŸ¢ SAFE\n- Responsive layouts (80 col minimum)\n- Keyboard-first with mouse support\n- Real-time updates via daemon\n\n## Files\n- internal/tui/dashboard/dashboard.go, panels/, keybindings.go\n- internal/tui/request/detail.go, approve.go, reject.go\n- internal/tui/history/browser.go, filters.go\n- internal/tui/components/commandbox.go, statusbadge.go, riskindicator.go, etc.\n- internal/tui/icons/icons.go\n- internal/tui/styles/styles.go, gradients.go, shimmer.go\n- internal/tui/theme/theme.go\n\n## Success Criteria\n1. Dashboard shows real-time agent and request status\n2. Request detail view displays all information clearly\n3. Approve/reject works from TUI\n4. History search works with FTS\n5. Keyboard navigation covers all actions\n6. Responsive to terminal width\n7. Themes apply consistently","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-13T18:13:54.922031239-06:00","updated_at":"2025-12-13T18:13:54.922031239-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-2t9","depends_on_id":"simultaneous_launch_button-f5d","type":"blocks","created_at":"2025-12-13T18:13:54.923443259-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-2t9","depends_on_id":"simultaneous_launch_button-f4c","type":"blocks","created_at":"2025-12-13T18:13:54.924328538-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-2t9.1","content_hash":"b63c881d5f198c1ad8f08b30801d00df780f4df161eea55fc0fbf0b53a50de2c","title":"Implement TUI dashboard main view","description":"## Task\nImplement the main dashboard view using Bubble Tea.\n\n## Layout (from plan)\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ SLB Dashboard                                     ğŸŸ¢ Daemon Running â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Agents (4)        â”‚ Pending Requests (2)                            â”‚\nâ”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚\nâ”‚ â”‚ ğŸŸ¢ GreenLake  â”‚ â”‚ â”‚ ğŸŸ  DANGEROUS rm -rf ./build                â”‚ â”‚\nâ”‚ â”‚   opus-4.5    â”‚ â”‚ â”‚   by GreenLake â€¢ 2m ago                    â”‚ â”‚\nâ”‚ â”‚ ğŸŸ¢ BlueDog    â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚\nâ”‚ â”‚   gpt-5.1     â”‚ â”‚ â”‚ ğŸ”´ CRITICAL kubectl delete node worker-3   â”‚ â”‚\nâ”‚ â”‚ ğŸŸ¡ RedCat     â”‚ â”‚ â”‚   by BlueDog â€¢ 5m ago                      â”‚ â”‚\nâ”‚ â”‚   opus-4.5    â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚\nâ”‚ â”‚ âšª PurpleBear â”‚ â”‚                                                 â”‚\nâ”‚ â”‚   (idle)      â”‚ â”‚ Recent Activity                                 â”‚\nâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ âœ“ BlueDog approved req-abc â€¢ 10m ago            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ 24h: 12 approved â”‚ 2 rejected â”‚ avg 45s response â”‚ [h]elp [q]uit   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n## Components\n- Header bar with title and daemon status\n- Left panel: agent list (scrollable)\n- Center panel: pending requests (focusable)\n- Right panel: recent activity log\n- Footer: stats and keybinding hints\n\n## Bubble Tea Model\n- dashboard.Model with panels as submodels\n- Focus management between panels\n- Real-time updates from daemon\n\n## Files\n- internal/tui/dashboard/dashboard.go\n- internal/tui/dashboard/model.go\n- internal/tui/dashboard/view.go\n- internal/tui/dashboard/update.go\n- internal/tui/dashboard/keybindings.go\n\n## Acceptance Criteria\n- [ ] Layout renders correctly\n- [ ] Panels are scrollable\n- [ ] Focus switches between panels\n- [ ] Real-time updates work\n- [ ] Responsive to terminal width","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:23:31.545182217-06:00","updated_at":"2025-12-13T18:23:31.545182217-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-2t9.1","depends_on_id":"simultaneous_launch_button-f5d.1","type":"blocks","created_at":"2025-12-13T18:23:31.546243043-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-2t9.1","depends_on_id":"simultaneous_launch_button-2t9.5","type":"blocks","created_at":"2025-12-13T18:31:41.136373073-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-2t9.2","content_hash":"da1adef96dcf269898411da849219e75a7ccf34fc4b9e6eef29b544f3c420f59","title":"Implement TUI request detail view","description":"## Task\nImplement the request detail view for reviewing and approving/rejecting.\n\n## Layout (from plan)\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Request Detail                               ğŸŸ  DANGEROUS â€¢ PENDING â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Command                                                             â”‚\nâ”‚ â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®â”‚\nâ”‚ â”‚ rm -rf ./build                                                    â”‚â”‚\nâ”‚ â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯â”‚\nâ”‚                                                                     â”‚\nâ”‚ Requestor: GreenLake (claude-code, opus-4.5) â€¢ 2 minutes ago        â”‚\nâ”‚                                                                     â”‚\nâ”‚ â”€â”€ Justification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚\nâ”‚ Reason: Removing stale build artifacts after failed compilation     â”‚\nâ”‚ Expected Effect: ./build directory deleted (~500MB)                 â”‚\nâ”‚ Goal: Free disk space before next build attempt                     â”‚\nâ”‚ Safety: Build is ephemeral, regenerated from source                 â”‚\nâ”‚                                                                     â”‚\nâ”‚ â”€â”€ Dry Run Output â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚\nâ”‚ Would remove:                                                       â”‚\nâ”‚   ./build/cache/ (245 files)                                        â”‚\nâ”‚   ./build/dist/ (12 files)                                          â”‚\nâ”‚                                                                     â”‚\nâ”‚ â”€â”€ Reviews (0/1 required) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚\nâ”‚ No reviews yet.                                                     â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ [a]pprove  [r]eject  [c]opy command  [ESC] back                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n## Features\n- Syntax highlighting for command\n- Scrollable sections\n- Approve/reject with optional comment\n- Copy command to clipboard\n\n## Files\n- internal/tui/request/detail.go\n- internal/tui/request/approve.go (approval form)\n- internal/tui/request/reject.go (rejection form)\n\n## Acceptance Criteria\n- [ ] All justification fields displayed\n- [ ] Dry-run output shown\n- [ ] Reviews listed\n- [ ] Approve/reject actions work\n- [ ] Keyboard shortcuts work","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:23:49.217532275-06:00","updated_at":"2025-12-13T18:23:49.217532275-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-2t9.2","depends_on_id":"simultaneous_launch_button-2t9.1","type":"blocks","created_at":"2025-12-13T18:23:49.218536526-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-2t9.3","content_hash":"8b57b67abfb35e091a8a83a5fea82ca5894e31727243cbeabfd693feb0f671bc","title":"Implement TUI history browser with FTS search","description":"## Task\nImplement the history browser view with full-text search.\n\n## Layout\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ History Browser                                           Page 1/12 â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Search: [kubectl delete________________]  [All Tiers â–¼] [All Status â–¼]â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ ID        â”‚ Command               â”‚ Agent     â”‚ Status   â”‚ When     â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ req-abc   â”‚ kubectl delete pod... â”‚ GreenLake â”‚ âœ“ EXEC   â”‚ 2h ago   â”‚\nâ”‚ req-def   â”‚ kubectl delete dep... â”‚ BlueDog   â”‚ âœ— REJ    â”‚ 5h ago   â”‚\nâ”‚ req-ghi   â”‚ rm -rf ./tmp          â”‚ GreenLake â”‚ âœ“ EXEC   â”‚ 1d ago   â”‚\nâ”‚ ...       â”‚                       â”‚           â”‚          â”‚          â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ [/] search  [â†â†’] page  [Enter] view  [ESC] back                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n## Features\n- FTS5 search (command, reason, agent)\n- Filters: tier, status, agent, date range\n- Paginated results\n- Click-through to detail view\n- Export to JSON\n\n## Search Syntax\nUses SQLite FTS5:\n- Simple text: \"kubectl\"\n- Phrase: '\"build plan\"'\n- Prefix: \"migrat*\"\n- Boolean: \"plan AND users\"\n\n## Files\n- internal/tui/history/browser.go\n- internal/tui/history/filters.go\n- internal/tui/history/search.go\n\n## Acceptance Criteria\n- [ ] FTS search works\n- [ ] Filters apply correctly\n- [ ] Pagination works\n- [ ] Detail view navigable\n- [ ] Responsive table layout","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:24:06.390946876-06:00","updated_at":"2025-12-13T18:24:06.390946876-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-2t9.3","depends_on_id":"simultaneous_launch_button-2t9.1","type":"blocks","created_at":"2025-12-13T18:24:06.391901233-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-2t9.4","content_hash":"89495afd5106c307aed6d0d9d5df1ee4aa4c5c82f46aa32de988e8e3259ea588","title":"Implement TUI theme and styling with Catppuccin","description":"## Task\nImplement the visual theme system using Catppuccin colors and lipgloss.\n\n## Theme: Catppuccin Mocha (default)\nFrom plan:\n- Mauve (#cba6f7): Titles, accents\n- Blue (#89b4fa): Section headers, links\n- Green (#a6e3a1): Success, approved, commands\n- Yellow (#f9e2af): Warning, caution tier\n- Red (#f38ba8): Error, critical tier\n- Peach (#fab387): Dangerous tier\n- Text (#cdd6f4): Normal text\n- Subtext (#a6adc8): Dimmed text\n- Surface (#313244): Panels, boxes\n- Base (#1e1e2e): Background\n\n## Tier Colors\n- ğŸ”´ CRITICAL: Red (#f38ba8)\n- ğŸŸ  DANGEROUS: Peach (#fab387)\n- ğŸŸ¡ CAUTION: Yellow (#f9e2af)\n- ğŸŸ¢ SAFE: Green (#a6e3a1)\n\n## Status Colors\n- PENDING: Blue\n- APPROVED: Green\n- REJECTED: Red\n- EXECUTED: Green (dimmed)\n- FAILED: Red (dimmed)\n\n## Theme Options\nSupport multiple Catppuccin flavors:\n- Mocha (default, dark)\n- Macchiato (dark)\n- Latte (light)\n- Nord (optional)\n\n## Visual Effects (internal/tui/styles/)\n- gradients.go: Animated gradient text for titles\n- shimmer.go: Shimmer/glow effects for highlights\n\n## Files\n- internal/tui/theme/theme.go\n- internal/tui/theme/catppuccin.go\n- internal/tui/styles/styles.go\n- internal/tui/styles/gradients.go\n- internal/tui/styles/shimmer.go\n\n## Acceptance Criteria\n- [ ] All colors defined correctly\n- [ ] Tier badges use correct colors\n- [ ] Theme switching works\n- [ ] Gradient text effects work\n- [ ] Shimmer effects for focus/selection\n- [ ] Light/dark themes available\n- [ ] Consistent styling throughout","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:24:23.384616886-06:00","updated_at":"2025-12-13T18:54:23.831654787-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-2t9.4","depends_on_id":"simultaneous_launch_button-v0z.1","type":"blocks","created_at":"2025-12-13T18:24:23.385590309-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-2t9.5","content_hash":"54c3c266d2c3f841b75e8fec01d9c8ce269e9053471b207ee3e0eb8dab353684","title":"Implement TUI shared components and icons","description":"## Task\nImplement shared UI components for consistent look across views.\n\n## Components (internal/tui/components/)\n\n### commandbox.go - Command Display Box\n- Syntax highlighted (if possible)\n- Rounded corners\n- Copy button hint\n- Scrollable for long commands\n\n### statusbadge.go - Status Badges\n- Colored background based on status\n- Icons: âœ“ âœ— â³ âš ï¸\n- Compact and full variants\n\n### riskindicator.go - Risk Tier Badges\n- ğŸ”´ CRITICAL\n- ğŸŸ  DANGEROUS\n- ğŸŸ¡ CAUTION\n- ğŸŸ¢ SAFE\n- Emoji with fallback for non-Unicode\n\n### agentcard.go - Agent List Item\n- Status indicator (active/idle/stale)\n- Program and model info\n- Time since last activity\n\n### timeline.go - Request Timeline\n- Shows request lifecycle visually\n- States: Created â†’ Pending â†’ Approved/Rejected â†’ Executing â†’ Executed\n- Timestamps for each transition\n- Compact and expanded views\n\n### spinner.go - Loading Spinner\n- Use bubbles/spinner\n- Custom styles\n\n### table.go - Data Table\n- Responsive column widths\n- Sortable headers\n- Selection highlight\n\n## Icons (internal/tui/icons/)\n\n### Nerd Font Icons (with ASCII fallbacks)\n- Approved: âœ“ or [OK]\n- Rejected: âœ— or [NO]\n- Pending: â³ or [..]\n- Warning: âš ï¸ or [!]\n- Agent: ó°€„ or [@]\n- Daemon: ó°’ or [D]\n\n## Files\n- internal/tui/components/*.go\n- internal/tui/icons/icons.go\n\n## Acceptance Criteria\n- [ ] All components render correctly\n- [ ] Icons have ASCII fallbacks\n- [ ] Timeline shows state transitions\n- [ ] Consistent styling\n- [ ] Reusable across views","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:24:39.830805216-06:00","updated_at":"2025-12-13T18:54:07.709008984-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-2t9.5","depends_on_id":"simultaneous_launch_button-2t9.4","type":"blocks","created_at":"2025-12-13T18:24:39.831692599-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-2t9.6","content_hash":"b6471c458cfb19a250f680d1a2ee0fd8303478bc888b91b6bbb6b8c17882e224","title":"Implement slb tui command to launch dashboard","description":"## Task\nImplement the `slb tui` command that launches the interactive dashboard.\n\n## Command: slb tui\n\n### Behavior\n- Launch full-screen Bubble Tea application\n- Show dashboard view by default\n- Navigate between views with keyboard\n- Real-time updates when daemon is running\n- Polling fallback when daemon is not running\n\n### Flags\n- --theme \u003cname\u003e: Override theme (mocha, macchiato, latte, nord)\n- --no-mouse: Disable mouse support\n- --refresh-interval \u003cseconds\u003e: Polling interval when no daemon (default 5)\n\n### View Navigation\n- 'd': Dashboard view\n- 'h': History browser view\n- 'p': Pending requests view\n- 'Enter': Open detail view for selected item\n- 'ESC': Go back / close\n- 'q' / Ctrl+C: Quit\n\n### Error Handling\n- If database not initialized: show helpful error and exit\n- If terminal too small: show resize message\n- If daemon not running: show warning, continue with polling\n\n## Files\n- internal/cli/tui.go\n\n## Acceptance Criteria\n- [ ] TUI launches correctly\n- [ ] Theme flag works\n- [ ] Navigation between views works\n- [ ] Graceful error messages\n- [ ] Works without daemon (polling mode)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:32:28.049748109-06:00","updated_at":"2025-12-13T18:32:28.049748109-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-2t9.6","depends_on_id":"simultaneous_launch_button-2t9.1","type":"blocks","created_at":"2025-12-13T18:32:28.050679864-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-2t9.6","depends_on_id":"simultaneous_launch_button-v0z.2","type":"blocks","created_at":"2025-12-13T18:32:28.051554323-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-399","content_hash":"a4901ce652ab17d3f38473c7004061fa4bc69dcdd654d54efd397bfad5f15a47","title":"EPIC: Session Management System","description":"## Overview\nImplement agent session management - the identity layer that enables tracking of which agent submitted/reviewed/executed commands.\n\n## Background \u0026 Rationale\nEach AI agent (Claude Code, Codex, Cursor, etc.) registers a session when it starts working. The session provides:\n- Identity (agent name like \"GreenLake\", program, model)\n- HMAC key for signing reviews (prevents replay attacks)\n- Heartbeat tracking for stale session detection\n\n## Key Commands (from plan)\n- `slb session start --agent \u003cname\u003e --program \u003cprog\u003e --model \u003cmodel\u003e` â†’ returns session_id + session_key\n- `slb session end --session-id \u003cid\u003e` â†’ marks session ended\n- `slb session resume --agent \u003cname\u003e` â†’ finds existing active session or creates new\n- `slb session list` â†’ shows active sessions\n- `slb session heartbeat --session-id \u003cid\u003e` â†’ updates last_active\n- `slb session reset-limits --session-id \u003cid\u003e` â†’ human can reset rate limits\n\n## Key Design Decisions\n1. **Unique Active Session**: Only one active session per (agent_name, project_path) enforced by partial unique index\n2. **HMAC Session Key**: Generated on session start, used to sign reviews\n3. **Auto-expire**: Sessions without heartbeat for 30min are considered stale\n4. **Resume Support**: Agents can resume after crash without creating duplicate sessions\n\n## Files\n- internal/core/session.go\n- internal/db/sessions.go\n- internal/cli/session.go\n\n## Success Criteria\n1. Session start returns JSON with session_id and session_key\n2. Duplicate active session prevented\n3. Session resume works after agent restart\n4. Stale sessions detected and cleaned up","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-13T18:11:37.9826173-06:00","updated_at":"2025-12-13T18:11:37.9826173-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-399","depends_on_id":"simultaneous_launch_button-f5d","type":"blocks","created_at":"2025-12-13T18:11:37.984293563-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-399.1","content_hash":"1c28791bcf7047bc1c113a5dce1f1d0d190a1e239706a25ab43929accf24eca8","title":"Implement SQLite CRUD operations for sessions","description":"## Task\nImplement database operations for session management.\n\n## Functions (internal/db/sessions.go)\n\n### Create\n- CreateSession(s *Session) error\n  - Generate UUID\n  - Generate HMAC session key\n  - Set started_at, last_active_at\n  - Return error if active session exists for agent+project\n\n### Read\n- GetSession(id string) (*Session, error)\n- GetActiveSession(agentName, projectPath string) (*Session, error)\n- ListActiveSessions(projectPath string) ([]*Session, error)\n- ListAllActiveSessions() ([]*Session, error)\n\n### Update\n- UpdateSessionHeartbeat(id string) error\n  - Update last_active_at to now\n- EndSession(id string) error\n  - Set ended_at to now\n\n### Query\n- FindStaleSessions(threshold time.Duration) ([]*Session, error)\n  - Sessions where last_active_at \u003c now - threshold AND ended_at IS NULL\n\n## Key Considerations\n- Session keys are sensitive - never log or serialize\n- Use prepared statements\n- Handle \"UNIQUE constraint failed\" for duplicate active sessions\n- Return meaningful errors\n\n## Files\n- internal/db/sessions.go\n\n## Acceptance Criteria\n- [ ] Create session generates valid UUID and key\n- [ ] Duplicate active session returns error\n- [ ] Heartbeat updates timestamp\n- [ ] End session sets ended_at\n- [ ] Stale session detection works","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:16:35.251279533-06:00","updated_at":"2025-12-13T19:44:59.819117738-06:00","closed_at":"2025-12-13T19:44:59.819117738-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-399.1","depends_on_id":"simultaneous_launch_button-f5d.2","type":"blocks","created_at":"2025-12-13T18:16:35.252429525-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-399.2","content_hash":"0f81455b4de20a2762c8fc97f03ee9a9107060988913e26ff1340a445e2fff33","title":"Implement session CLI commands","description":"## Task\nImplement all session-related CLI commands using Cobra.\n\n## Commands (internal/cli/session.go)\n\n### slb session start\n- Flags: --agent/-a, --program/-p, --model/-m\n- Creates new session\n- Returns JSON: { session_id, session_key, agent_name, started_at }\n- Error if active session exists (suggest resume)\n\n### slb session end\n- Flags: --session-id/-s\n- Marks session as ended\n- Returns JSON: { session_id, ended_at }\n\n### slb session resume\n- Flags: --agent/-a, --program/-p (optional)\n- Finds existing active session or creates new\n- Matches on agent_name + program + project_path\n- Returns same format as start\n\n### slb session list\n- Flags: --project/-C\n- Lists active sessions\n- JSON: array of session objects\n\n### slb session heartbeat\n- Flags: --session-id/-s\n- Updates last_active_at\n- Returns JSON: { session_id, last_active_at }\n\n### slb session reset-limits\n- Flags: --session-id/-s\n- Resets rate limits for session\n- Human-only operation\n\n## JSON Output\nAll commands support --json flag.\nHuman-readable output to stderr, JSON to stdout.\n\n## Files\n- internal/cli/session.go\n\n## Acceptance Criteria\n- [ ] All session commands implemented\n- [ ] JSON output matches snake_case contract\n- [ ] Error messages are helpful\n- [ ] Tab completion works for session IDs","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:16:51.246772354-06:00","updated_at":"2025-12-13T19:50:44.478149623-06:00","closed_at":"2025-12-13T19:50:44.478149623-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-399.2","depends_on_id":"simultaneous_launch_button-399.1","type":"blocks","created_at":"2025-12-13T18:16:51.247697286-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-399.2","depends_on_id":"simultaneous_launch_button-v0z.2","type":"blocks","created_at":"2025-12-13T18:16:51.248565864-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-399.3","content_hash":"8a892276a6f09e81117ab7d43f31c0e3e6122ea66b42c62e871b35231a0cba63","title":"Implement session resume logic for agent reliability","description":"## Task\nImplement robust session resume logic so agents can recover from crashes.\n\n## Background\nWhen an agent crashes and restarts, it shouldn't create a duplicate session. Instead, it should resume its existing session if one is still active.\n\n## slb session resume Command\nFlags:\n- --agent/-a (required): Agent name\n- --program/-p (optional): Program name for matching\n- --create-if-missing: Create new session if no active session found\n\n## Logic (internal/core/session.go)\n\n### ResumeSession(opts ResumeOptions) (*Session, error)\n1. Look for active session matching (agent_name, project_path)\n2. If found AND program matches (if specified):\n   - Update last_active_at (heartbeat)\n   - Return existing session (with session_key from DB)\n3. If found BUT program different:\n   - Option A: Return error \"Different program has this session\"\n   - Option B: If --force, end old session, create new\n4. If not found AND --create-if-missing:\n   - Create new session\n5. If not found AND NOT --create-if-missing:\n   - Return error \"No active session found\"\n\n### Session Key Handling\nThe session_key is only returned on:\n- session start (new session)\n- session resume (existing session)\n\nNever stored in plain text anywhere else. Agent must save it in memory or secure storage.\n\n## Crash Recovery Flow\n```bash\n# Agent startup script\nSESSION_JSON=$(slb session resume --agent \"$AGENT_NAME\" --create-if-missing --json)\nSESSION_ID=$(echo \"$SESSION_JSON\" | jq -r '.session_id')\nSESSION_KEY=$(echo \"$SESSION_JSON\" | jq -r '.session_key')\n```\n\n## Files\n- internal/core/session.go\n- internal/cli/session.go (update)\n\n## Acceptance Criteria\n- [ ] Resume finds existing active session\n- [ ] Session key returned correctly\n- [ ] --create-if-missing works\n- [ ] Clear errors for mismatched sessions\n- [ ] Heartbeat updated on resume","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:34:59.581197973-06:00","updated_at":"2025-12-13T20:03:57.410029575-06:00","closed_at":"2025-12-13T20:03:57.410029575-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-399.3","depends_on_id":"simultaneous_launch_button-399.1","type":"blocks","created_at":"2025-12-13T18:34:59.58216269-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-3s8","content_hash":"23d636deb62aeec5169b921b1e16843ab75fdc88f847f63477df86ec8d7426a9","title":"EPIC: Request Management \u0026 Lifecycle","description":"## Overview\nImplement the request creation, lifecycle, and state management - the core \"submit for approval\" workflow.\n\n## Background \u0026 Rationale\nWhen an agent wants to run a dangerous command, it creates a Request. The request includes:\n- The command (with hash binding for security)\n- Justification (reason, expected effect, goal, safety argument)\n- Optional dry-run output and attachments\n- State tracking through the lifecycle\n\n## Key Commands (from plan)\nPrimary (agents should use this):\n- `slb run \"\u003ccommand\u003e\" --reason \"...\" [--expected-effect \"...\"] [--goal \"...\"] [--safety \"...\"]`\n  â†’ Atomic: checks pattern, creates request if needed, waits, executes if approved\n\nPlumbing (advanced workflows):\n- `slb request \"\u003ccommand\u003e\" --reason \"...\" --wait --execute`\n- `slb status \u003crequest-id\u003e [--wait]`\n- `slb cancel \u003crequest-id\u003e`\n- `slb pending [--project \u003cpath\u003e] [--all-projects]`\n\n## Key Design Decisions (v2.0.0)\n1. **CommandSpec with Hash**: sha256(raw + cwd + argv_json + shell) binds approval to exact command\n2. **Justification Fields**: reason (required), expected_effect, goal, safety_argument (optional)\n3. **Approval TTL**: Approved requests expire after 30min (10min for CRITICAL)\n4. **Rate Limiting**: max 5 concurrent pending, max 10/minute per session\n5. **Sensitive Data Redaction**: --redact patterns for logs/display\n\n## State Machine (from plan)\nCREATED â†’ PENDING â†’ APPROVED/REJECTED â†’ EXECUTING â†’ EXECUTED/EXECUTION_FAILED/TIMED_OUT\nAlso: CANCELLED, TIMEOUT, ESCALATED\n\n## Files\n- internal/core/request.go\n- internal/core/statemachine.go\n- internal/db/requests.go\n- internal/cli/request.go, run.go, status.go, pending.go, cancel.go\n\n## Success Criteria\n1. Request creation validates and stores with proper hash\n2. State transitions follow state machine rules\n3. Rate limits enforced per session\n4. Approval TTL prevents stale executions\n5. Sensitive data redacted in display/logs","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-13T18:12:15.9362779-06:00","updated_at":"2025-12-13T18:12:15.9362779-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-3s8","depends_on_id":"simultaneous_launch_button-399","type":"blocks","created_at":"2025-12-13T18:12:15.937656899-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-3s8","depends_on_id":"simultaneous_launch_button-qr8","type":"blocks","created_at":"2025-12-13T18:12:15.93862898-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-3s8.1","content_hash":"c6e6ec5c96e7a6244a3e59bdf150cdf4895387aaf251f661aed02b4649e7bdd2","title":"Implement SQLite CRUD operations for requests","description":"## Task\nImplement database operations for request management.\n\n## Functions (internal/db/requests.go)\n\n### Create\n- CreateRequest(r *Request) error\n  - Generate UUID\n  - Compute command_hash\n  - Set created_at, expires_at\n  - Check rate limits before insert\n\n### Read\n- GetRequest(id string) (*Request, error)\n- GetRequestWithReviews(id string) (*Request, []*Review, error)\n- ListPendingRequests(projectPath string) ([]*Request, error)\n- ListPendingRequestsAllProjects() ([]*Request, error)\n- ListRequestsByStatus(status RequestStatus, projectPath string) ([]*Request, error)\n\n### Update\n- UpdateRequestStatus(id string, status RequestStatus) error\n  - Validate state transition (use state machine)\n  - Set resolved_at for terminal states\n- UpdateRequestExecution(id string, exec *Execution) error\n  - Set execution details and status\n\n### Query\n- CountPendingBySession(sessionID string) (int, error)\n  - For rate limiting\n- SearchRequests(query string) ([]*Request, error)\n  - FTS5 search\n\n### Expiry\n- FindExpiredRequests() ([]*Request, error)\n  - Pending requests where expires_at \u003c now\n\n## CommandSpec Hash Computation\nsha256(raw + \"\\n\" + cwd + \"\\n\" + json(argv) + \"\\n\" + shell_bool)\n\n## Files\n- internal/db/requests.go\n- internal/db/fts.go (search queries)\n\n## Acceptance Criteria\n- [ ] Create generates valid hash\n- [ ] State transitions validated\n- [ ] Rate limit check works\n- [ ] FTS search returns matches\n- [ ] Expiry query finds old requests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:18:03.359413911-06:00","updated_at":"2025-12-13T19:53:10.70499286-06:00","closed_at":"2025-12-13T19:53:10.70499286-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-3s8.1","depends_on_id":"simultaneous_launch_button-f5d.2","type":"blocks","created_at":"2025-12-13T18:18:03.360536562-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-3s8.2","content_hash":"a8598cfc8c0bbc9a8e5aa26ed85a3ce5cdbdc610520d194d9ce0a84f5bb140e1","title":"Implement request state machine","description":"## Task\nImplement the request lifecycle state machine to enforce valid transitions.\n\n## State Diagram (from plan)\nCREATED â†’ PENDING â†’ APPROVED/REJECTED â†’ EXECUTING â†’ EXECUTED/EXECUTION_FAILED/TIMED_OUT\n\nAdditional states: CANCELLED, TIMEOUT, ESCALATED\n\n## Valid Transitions\n- (new) â†’ PENDING: Request creation\n- PENDING â†’ APPROVED: Required approvals received\n- PENDING â†’ REJECTED: Any rejection received\n- PENDING â†’ CANCELLED: Requestor cancels\n- PENDING â†’ TIMEOUT: Expiry time reached\n- TIMEOUT â†’ ESCALATED: Human notified\n- APPROVED â†’ EXECUTING: Execute begins\n- APPROVED â†’ CANCELLED: Requestor decides not to execute\n- EXECUTING â†’ EXECUTED: Command succeeds\n- EXECUTING â†’ EXECUTION_FAILED: Command fails\n- EXECUTING â†’ TIMED_OUT: Execution timeout\n\n## Terminal States\n- EXECUTED, EXECUTION_FAILED, TIMED_OUT, REJECTED (all terminal)\n\n## Functions (internal/core/statemachine.go)\n\n### CanTransition(from, to RequestStatus) bool\n- Returns true if transition is valid\n\n### Transition(req *Request, to RequestStatus) error\n- Validates transition\n- Updates request status\n- Sets timestamps (resolved_at for terminal states)\n\n### IsTerminal(status RequestStatus) bool\n- Returns true for terminal states\n\n## Files\n- internal/core/statemachine.go\n\n## Acceptance Criteria\n- [ ] All valid transitions defined\n- [ ] Invalid transitions rejected with clear error\n- [ ] Terminal states correctly identified\n- [ ] Timestamps set on transitions","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T18:18:17.65961377-06:00","updated_at":"2025-12-13T19:39:42.951356792-06:00","closed_at":"2025-12-13T19:39:42.951356792-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-3s8.2","depends_on_id":"simultaneous_launch_button-f5d.1","type":"blocks","created_at":"2025-12-13T18:18:17.660651873-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-3s8.3","content_hash":"472d9a4f0bfab4902a259daeb81ad16f25d0cdab1efdde2465c9228b82a91758","title":"Implement request creation core logic","description":"## Task\nImplement the core logic for creating command approval requests.\n\n## Functions (internal/core/request.go)\n\n### CreateRequest(opts CreateRequestOptions) (*Request, error)\nOptions:\n- SessionID (required)\n- Command (raw string)\n- Cwd (working directory)\n- Justification (reason, expected_effect, goal, safety_argument)\n- Attachments (optional)\n- RedactPatterns (optional)\n\nLogic:\n1. Validate session exists and is active\n2. Check agent not in [agents].blocked list\n3. Check rate limits (max pending, requests/minute)\n4. Classify command â†’ get tier\n5. If SAFE tier, skip (return nil, nil with special indicator)\n6. Parse command to argv if possible\n7. Compute command hash\n8. Apply redaction patterns for display version\n9. Get min_approvals for tier (check dynamic quorum)\n10. Set expiry time based on config\n11. Create request in DB\n12. Materialize JSON file in .slb/pending/\n\n### ComputeCommandHash(spec *CommandSpec) string\nsha256(raw + \"\\n\" + cwd + \"\\n\" + json(argv) + \"\\n\" + shell_bool)\n\n### ApplyRedaction(cmd string, patterns []string) string\n- Apply patterns to create display version\n- Also apply default redaction patterns (passwords, tokens, env vars)\n- Never redact the actual command\n\n### CheckDynamicQuorum(tier RiskTier, activeSessions int) int\n- If dynamic_quorum enabled and fewer agents than needed:\n  - Adjust min_approvals to active_sessions - 1 (requestor excluded)\n  - Never below dynamic_quorum_floor\n\n## Blocked Agents\nFrom [agents].blocked config:\n- Agents in this list cannot create requests\n- Return clear error: \"Agent is blocked from creating requests\"\n\n## Files\n- internal/core/request.go\n\n## Acceptance Criteria\n- [ ] Blocked agents rejected\n- [ ] Rate limits enforced\n- [ ] Command hash computed correctly\n- [ ] Default and custom redaction works\n- [ ] Dynamic quorum adjusts approvals\n- [ ] JSON file created in pending/","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:18:37.299792591-06:00","updated_at":"2025-12-13T20:09:52.220115985-06:00","closed_at":"2025-12-13T20:09:52.220115985-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-3s8.3","depends_on_id":"simultaneous_launch_button-3s8.1","type":"blocks","created_at":"2025-12-13T18:18:37.300748581-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-3s8.3","depends_on_id":"simultaneous_launch_button-3s8.2","type":"blocks","created_at":"2025-12-13T18:18:37.301699312-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-3s8.3","depends_on_id":"simultaneous_launch_button-qr8.1","type":"blocks","created_at":"2025-12-13T18:18:37.302567399-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-3s8.3","depends_on_id":"simultaneous_launch_button-3s8.6","type":"blocks","created_at":"2025-12-13T18:35:50.242523041-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-3s8.4","content_hash":"36624a488eed69c89030cd63757ede21d78feff2702b48709fa394dbfd013dd8","title":"Implement request CLI commands (run, request, status, pending, cancel)","description":"## Task\nImplement CLI commands for request management.\n\n## Commands\n\n### slb run \"\u003ccommand\u003e\" (PRIMARY - Atomic execution)\n- Flags: --reason (required), --expected-effect, --goal, --safety, --justification\n- Flags: --session-id/-s, --timeout, --yield\n- Behavior:\n  1. Check patterns â†’ if SAFE, execute immediately\n  2. If DANGEROUS/CRITICAL: create request, block, wait\n  3. If approved: execute IN CALLER'S SHELL ENVIRONMENT\n  4. If rejected/timeout: exit 1 with JSON error\n- JSON: { status, exit_code, request_id, ... }\n\n### slb request \"\u003ccommand\u003e\" (Plumbing)\n- Flags: --reason, --expected-effect, --goal, --safety, --justification\n- Flags: --meta-file, --from-stdin, --attach-file, --attach-context\n- Flags: --redact, --session-id, --wait, --execute, --timeout\n- Creates request, optionally waits and executes\n- JSON: { request_id, status, tier, ... }\n\n### slb status \u003crequest-id\u003e\n- Flags: --wait (block until decision)\n- Shows current status, reviews received\n- JSON: full request with reviews\n\n### slb pending\n- Flags: --project/-C, --all-projects, --review-pool\n- Lists pending requests\n- JSON: array of request summaries\n\n### slb cancel \u003crequest-id\u003e\n- Flags: --session-id/-s\n- Cancels own request\n- JSON: { request_id, status: \"cancelled\" }\n\n## Files\n- internal/cli/run.go\n- internal/cli/request.go\n- internal/cli/status.go\n- internal/cli/pending.go\n- internal/cli/cancel.go\n\n## Acceptance Criteria\n- [ ] slb run is atomic and handles all flows\n- [ ] Commands inherit caller's environment\n- [ ] --wait blocks correctly\n- [ ] JSON output matches contract","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-13T18:18:53.455669749-06:00","updated_at":"2025-12-13T20:14:34.429284426-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-3s8.4","depends_on_id":"simultaneous_launch_button-3s8.3","type":"blocks","created_at":"2025-12-13T18:18:53.456724524-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-3s8.4","depends_on_id":"simultaneous_launch_button-v0z.2","type":"blocks","created_at":"2025-12-13T18:18:53.457770643-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-3s8.5","content_hash":"b9d07a801fd1ec26509790924f619711b42b1538094b5c68e5d1cc05b0a15faf","title":"Implement context attachments for requests","description":"## Task\nImplement context attachments that provide additional information for reviewers.\n\n## Attachment Types (from plan)\n\n### file_snippet\nContent from relevant files (e.g., kubectl get nodes output)\n{\n  \"type\": \"file_snippet\",\n  \"content\": \"NAME       STATUS     ROLES...\",\n  \"metadata\": { \"source\": \"kubectl get nodes\" }\n}\n\n### log_excerpt\nRelevant log entries\n{\n  \"type\": \"log_excerpt\",\n  \"content\": \"ERROR: Build failed at step 5...\",\n  \"metadata\": { \"file\": \"build.log\", \"lines\": \"450-460\" }\n}\n\n### screenshot\nImage attachment (converted to base64)\n{\n  \"type\": \"screenshot\",\n  \"content\": \"data:image/png;base64,...\",\n  \"metadata\": { \"description\": \"Error dialog\" }\n}\n\n### diff\nGit diff or similar\n{\n  \"type\": \"diff\",\n  \"content\": \"--- a/file\\n+++ b/file\\n...\",\n  \"metadata\": { \"ref\": \"HEAD~1\" }\n}\n\n## CLI Flags\n- --attach-file \u003cpath\u003e: Attach file content\n- --attach-context \u003ccmd\u003e: Run command and attach output\n- --attach-screenshot \u003cpath\u003e: Attach image\n\n## Functions (internal/core/attachments.go)\n\n### AddAttachment(req *Request, att *Attachment) error\n- Validate attachment\n- Store in request\n\n### LoadAttachmentFromFile(path string) (*Attachment, error)\n- Read file\n- Detect type\n- Create attachment\n\n### RunContextCommand(cmd string) (*Attachment, error)\n- Execute command\n- Capture output\n- Create attachment\n\n## Files\n- internal/core/attachments.go\n\n## Acceptance Criteria\n- [ ] File attachments work\n- [ ] Context commands captured\n- [ ] Screenshots embedded\n- [ ] Attachments displayed in TUI\n- [ ] Size limits enforced","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:25:36.455976738-06:00","updated_at":"2025-12-13T18:25:36.455976738-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-3s8.5","depends_on_id":"simultaneous_launch_button-3s8.3","type":"blocks","created_at":"2025-12-13T18:25:36.456957565-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-3s8.6","content_hash":"d312575eaad684fed137082ba8a6b6f010f81c3f575f5e2a920693756ec91cd1","title":"Implement per-session rate limiting","description":"## Task\nImplement rate limiting to prevent malfunctioning agents from flooding the review queue.\n\n## Rate Limits (from plan)\n- max_pending_per_session: 5 (default)\n- max_requests_per_minute: 10 (default)\n\n## Functions (internal/core/ratelimit.go)\n\n### CheckRateLimit(sessionID string) (*RateLimitResult, error)\nReturns:\n- Allowed: bool\n- RemainingPending: int\n- RemainingPerMinute: int\n- ResetAt: time.Time (for per-minute limit)\n- Error message if blocked\n\n### Logic\n1. Count pending requests for this session\n   - SELECT COUNT(*) FROM requests WHERE requestor_session_id = ? AND status = 'pending'\n2. If count \u003e= max_pending_per_session â†’ reject\n3. Count requests in last minute\n   - SELECT COUNT(*) FROM requests WHERE requestor_session_id = ? AND created_at \u003e now() - 60s\n4. If count \u003e= max_requests_per_minute â†’ reject\n5. Return allowed\n\n### Rate Limit Actions (configurable)\n- \"reject\": Immediately reject with clear error\n- \"queue\": Queue request but delay processing\n- \"warn\": Allow but log warning\n\n### Human Reset\n- `slb session reset-limits --session-id \u003cid\u003e`\n- Requires human (not agent) invocation\n- Resets counters for session\n\n### Tracking\nStore in memory (per daemon process) or in a rate_limit_events table:\n- session_id\n- event_type (request, reset)\n- timestamp\n\n## Configuration\n[rate_limits]\nmax_pending_per_session = 5\nmax_requests_per_minute = 10\nrate_limit_action = \"reject\"\n\n## Files\n- internal/core/ratelimit.go\n\n## Acceptance Criteria\n- [ ] Pending limit enforced\n- [ ] Per-minute limit enforced\n- [ ] Clear error messages\n- [ ] Human reset works\n- [ ] Limits configurable","status":"closed","priority":1,"issue_type":"task","assignee":"BrownCastle","created_at":"2025-12-13T18:32:44.623595127-06:00","updated_at":"2025-12-13T20:09:42.603563122-06:00","closed_at":"2025-12-13T20:09:42.603563122-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-3s8.6","depends_on_id":"simultaneous_launch_button-399.1","type":"blocks","created_at":"2025-12-13T18:32:44.624494052-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-7js","content_hash":"5c0da9172c8cfa12de5522cc6880c2e3232b226c46a3eb30981b30c10c4fa6b1","title":"EPIC: Testing \u0026 Quality Assurance","description":"## Overview\nImplement comprehensive testing: unit tests, integration tests, and cross-platform verification.\n\n## Background \u0026 Rationale\nslb handles potentially destructive commands. Quality is critical. The plan specifies tests in Phase 1 for core logic.\n\n## Test Categories\n\n### Unit Tests\n- Pattern matching (regex, normalization, tier classification)\n- State machine transitions\n- Command hash computation\n- Signature verification\n- Session management\n- Rate limiting logic\n- Config loading and validation\n\n### Integration Tests\n- Full requestâ†’approveâ†’execute cycle\n- Request timeout and escalation\n- Daemon start/stop/restart\n- File watcher notifications\n- FTS search\n- Bulk approve operations\n\n### Cross-Platform Tests\n- Linux (primary)\n- macOS (important)\n- Windows (later, file watching differs)\n\n### Edge Case Tests\n- No other agents available\n- Self-approval prevention\n- Conflicting reviews\n- Stale sessions\n- Large dry-run output\n- Request during daemon downtime\n- Filesystem permission errors\n- Request flooding (rate limits)\n- No different-model reviewer\n\n## Files\n- *_test.go files alongside source\n- internal/testutil/ for shared test helpers\n- tests/integration/ for integration tests\n\n## Test Infrastructure\n- Go's testing package\n- Table-driven tests for pattern matching\n- Testcontainers for integration tests (optional)\n- GitHub Actions CI workflow\n\n## Success Criteria\n1. Pattern matching has 100% test coverage\n2. State machine transitions tested\n3. Integration test covers full workflow\n4. CI runs tests on every PR\n5. Edge cases documented and tested","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-13T18:14:51.530698007-06:00","updated_at":"2025-12-13T18:14:51.530698007-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-7js","depends_on_id":"simultaneous_launch_button-7wh","type":"blocks","created_at":"2025-12-13T18:14:51.532575615-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7js","depends_on_id":"simultaneous_launch_button-2t9","type":"blocks","created_at":"2025-12-13T18:14:51.534004506-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-7js.1","content_hash":"c4d67e36375dc8811f654ca4c70ad02b8e76b564fe17b39eb85aacfc3084c075","title":"Implement unit tests for pattern matching","description":"## Task\nWrite comprehensive unit tests for the pattern matching engine.\n\n## Test Categories\n\n### Pattern Matching Tests\n- Test each default pattern matches expected commands\n- Test case insensitivity\n- Test negative lookahead patterns\n- Test regex edge cases\n\n### Command Normalization Tests\n- sudo stripping: \"sudo rm -rf\" â†’ \"rm -rf\"\n- env stripping: \"env FOO=bar kubectl\" â†’ \"kubectl\"\n- Multiple wrappers: \"sudo env FOO=bar rm\" â†’ \"rm\"\n- Compound commands: \"cd /etc \u0026\u0026 rm -rf *\"\n- Subshells: \"$(rm -rf /)\"\n- Pipes: \"echo | rm -rf\"\n\n### Tier Classification Tests\n- SAFE patterns skip review\n- CRITICAL patterns require 2+ approvals\n- DANGEROUS patterns require 1 approval\n- CAUTION patterns auto-approve\n- No match allows without review\n\n### Path Resolution Tests\n- Relative paths expanded: \"./build\" â†’ \"/full/path/build\"\n- Parent traversal: \"../secrets\" â†’ resolved path\n- Home expansion: \"~/\" â†’ full home path\n\n### Edge Cases\n- Empty command\n- Whitespace-only command\n- Very long commands\n- Unicode in paths\n- Quotes in commands\n\n## Test Structure\nUse table-driven tests for comprehensive coverage.\n\n## Files\n- internal/core/patterns_test.go\n- internal/core/normalize_test.go\n\n## Acceptance Criteria\n- [ ] All default patterns have test coverage\n- [ ] Normalization handles all wrapper types\n- [ ] Path resolution tests pass\n- [ ] Edge cases covered\n- [ ] Tests run in CI","status":"in_progress","priority":1,"issue_type":"task","assignee":"BrownLake","created_at":"2025-12-13T18:20:56.662520711-06:00","updated_at":"2025-12-13T19:54:43.888462608-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-7js.1","depends_on_id":"simultaneous_launch_button-qr8.1","type":"blocks","created_at":"2025-12-13T18:20:56.663439943-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7js.1","depends_on_id":"simultaneous_launch_button-qr8.2","type":"blocks","created_at":"2025-12-13T18:20:56.664289275-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-7js.2","content_hash":"3ed4a01225af566a9771e4d42c68ac5319f3f9b3548e0c06cc2b0b15bcbc64ff","title":"Implement unit tests for state machine transitions","description":"## Task\nWrite comprehensive unit tests for the request state machine.\n\n## Test Categories\n\n### Valid Transitions\n- (new) â†’ PENDING\n- PENDING â†’ APPROVED (enough approvals)\n- PENDING â†’ REJECTED (any rejection)\n- PENDING â†’ CANCELLED (requestor cancels)\n- PENDING â†’ TIMEOUT (expiry reached)\n- TIMEOUT â†’ ESCALATED (human notified)\n- APPROVED â†’ EXECUTING\n- APPROVED â†’ CANCELLED\n- EXECUTING â†’ EXECUTED\n- EXECUTING â†’ EXECUTION_FAILED\n- EXECUTING â†’ TIMED_OUT\n\n### Invalid Transitions\n- PENDING â†’ EXECUTED (must go through APPROVED)\n- APPROVED â†’ APPROVED (no re-approval)\n- EXECUTED â†’ PENDING (terminal state)\n- REJECTED â†’ APPROVED (terminal state)\n- Any â†’ CREATED (only initial state)\n\n### Terminal State Tests\n- EXECUTED is terminal\n- EXECUTION_FAILED is terminal\n- TIMED_OUT is terminal\n- REJECTED is terminal\n- CANCELLED is terminal\n\n### Timestamp Tests\n- created_at set on creation\n- resolved_at set on terminal transitions\n- approval_expires_at set on APPROVED transition\n\n### Edge Cases\n- Transition to same state\n- Transition from nil/empty state\n- Concurrent transitions\n\n## Test Structure\nTable-driven tests with from/to/expected outcome.\n\n## Files\n- internal/core/statemachine_test.go\n\n## Acceptance Criteria\n- [ ] All valid transitions tested\n- [ ] Invalid transitions rejected\n- [ ] Terminal states correctly identified\n- [ ] Timestamps set correctly\n- [ ] Tests run in CI","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:21:12.081684073-06:00","updated_at":"2025-12-13T19:45:13.918025656-06:00","closed_at":"2025-12-13T19:45:13.918025656-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-7js.2","depends_on_id":"simultaneous_launch_button-3s8.2","type":"blocks","created_at":"2025-12-13T18:21:12.082674508-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-7js.3","content_hash":"cd9cec4ba01279a7b974a3e8c89b5de62c0e9619ab70c60c8f6864de128e8814","title":"Implement Git history repository for audit trail","description":"## Task\nImplement optional Git repository for audit trail of all slb activity.\n\n## Purpose\nSeparate Git repo that stores complete history of:\n- All requests (approved, rejected, cancelled)\n- All reviews with signatures\n- Execution outcomes\n- Pattern changes\n\nThis provides:\n- Permanent audit trail\n- Easy grep/search through history\n- Shareable across team\n- Backup of decision-making\n\n## Repository Structure\n.slb-history/\nâ”œâ”€â”€ .git/\nâ”œâ”€â”€ requests/\nâ”‚   â””â”€â”€ 2025/\nâ”‚       â””â”€â”€ 12/\nâ”‚           â””â”€â”€ req-abc123.json\nâ”œâ”€â”€ reviews/\nâ”‚   â””â”€â”€ 2025/\nâ”‚       â””â”€â”€ 12/\nâ”‚           â””â”€â”€ rev-def456.json\nâ”œâ”€â”€ executions/\nâ”‚   â””â”€â”€ 2025/\nâ”‚       â””â”€â”€ 12/\nâ”‚           â””â”€â”€ exec-ghi789.json\nâ””â”€â”€ patterns/\n    â””â”€â”€ changes.jsonl\n\n## Functions (internal/git/history.go)\n\n### InitHistoryRepo(path string) error\n- Initialize Git repo at path\n- Create directory structure\n\n### CommitRequest(req *Request) error\n- Write request JSON\n- Git add and commit\n- Commit message: \"Request: \u003ccommand truncated\u003e\"\n\n### CommitReview(rev *Review) error\n- Write review JSON\n- Git add and commit\n- Commit message: \"Review: \u003cdecision\u003e for \u003crequest-id\u003e\"\n\n### CommitExecution(exec *Execution) error\n- Write execution JSON\n- Git add and commit\n\n## Configuration\n[history]\ngit_repo_path = \"~/.slb/history\"\nauto_git_commit = true\nretention_days = 365\n\n## Files\n- internal/git/history.go\n- internal/git/repo.go\n\n## Acceptance Criteria\n- [ ] Repo initializes correctly\n- [ ] Commits created on events\n- [ ] Searchable history\n- [ ] Configurable path","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:25:53.585586833-06:00","updated_at":"2025-12-13T18:25:53.585586833-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-7js.3","depends_on_id":"simultaneous_launch_button-3s8.3","type":"blocks","created_at":"2025-12-13T18:25:53.586592897-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7js.3","depends_on_id":"simultaneous_launch_button-jrn.2","type":"blocks","created_at":"2025-12-13T18:25:53.587502141-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-7js.4","content_hash":"8f26821d60dbf5c6d1e37cce0ebb4568daf93959f24477f1f782ff8cdde30595","title":"Implement integration tests for full workflow","description":"## Task\nWrite integration tests that cover the full requestâ†’approveâ†’execute workflow.\n\n## Test Scenarios\n\n### Happy Path\n1. Initialize slb (slb init)\n2. Start session A (requestor)\n3. Start session B (reviewer)\n4. Session A: slb request \"rm -rf ./test-dir\"\n5. Session B: slb approve \u003crequest-id\u003e\n6. Session A: slb execute \u003crequest-id\u003e\n7. Verify execution success\n8. Check audit trail\n\n### Rejection Path\n1. Create request\n2. Reject request\n3. Verify state is REJECTED\n4. Verify cannot execute\n\n### Timeout Path\n1. Create request with short timeout\n2. Wait for timeout\n3. Verify state is TIMEOUT\n4. Verify escalation\n\n### Self-Approval Prevention\n1. Create request\n2. Try to approve own request\n3. Verify rejection with error\n\n### Rate Limiting\n1. Create 6 pending requests\n2. Verify 6th is rejected (max 5)\n\n### Daemon Integration\n1. Start daemon\n2. Create request\n3. Verify notification sent\n4. Approve via watch\n5. Stop daemon\n\n## Test Infrastructure\n- Use temp directories\n- Cleanup after each test\n- Parallel test execution\n- CI integration\n\n## Files\n- tests/integration/workflow_test.go\n- tests/integration/daemon_test.go\n- tests/integration/helpers.go\n\n## Acceptance Criteria\n- [ ] Happy path passes\n- [ ] Edge cases covered\n- [ ] Tests run in CI\n- [ ] Cleanup works\n- [ ] Parallel safe","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:27:19.118525499-06:00","updated_at":"2025-12-13T18:27:19.118525499-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-7js.4","depends_on_id":"simultaneous_launch_button-7wh","type":"blocks","created_at":"2025-12-13T18:27:19.119497109-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7js.4","depends_on_id":"simultaneous_launch_button-f4c.6","type":"blocks","created_at":"2025-12-13T18:27:19.120482805-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-7wh","content_hash":"1d7e6d66d82c73771db890604b81b1e20d00104b921bb4d1b2ffa56ca02ecc83","title":"EPIC: CLI Command Suite","description":"## Overview\nImplement all CLI commands using Cobra, with consistent JSON output and beautiful colorized help.\n\n## Background \u0026 Rationale\nThe CLI is agent-first. Every command supports --json for structured output. The TUI is the ONLY human-facing interactive interface. The CLI is designed for programmatic consumption.\n\n## Key Design Principles\n1. **JSON Output Contract**: All keys snake_case, timestamps RFC3339 UTC\n2. **Human-friendly to stderr**: Colored output goes to stderr\n3. **Machine JSON to stdout**: Structured data for parsing\n4. **NDJSON for Streaming**: slb watch outputs one JSON object per line\n5. **Short Flags**: -s/--session-id, -j/--json, -C/--project\n\n## Command Categories\n\n### Initialization\n- `slb init [--force]` â†’ create .slb/ structure\n- `slb version [--json]` â†’ version, build info, config paths\n\n### Session (see Session epic)\n- session start/end/resume/list/heartbeat/reset-limits\n\n### Request/Run (see Request epic)\n- run, request, status, pending, cancel\n\n### Review (see Review epic)\n- review, approve, reject\n\n### Execute (see Execute epic)\n- execute, emergency-execute, rollback\n\n### History \u0026 Search\n- `slb history [--query \"...\"] [--status \u003cs\u003e] [--agent \u003cn\u003e] [--since \u003cd\u003e]`\n- `slb show \u003crequest-id\u003e` â†’ detailed view\n\n### Configuration\n- `slb config [--global | --project]`\n- `slb config get/set \u003ckey\u003e [\u003cvalue\u003e]`\n- `slb config edit` â†’ opens in $EDITOR\n\n### Patterns (see Patterns epic)\n- patterns list/test/add/remove/request-removal/suggest\n\n### Quick Reference Card\n- `slb` (no args) â†’ prints colorful quick reference with lipgloss styling\n\n## Files\n- internal/cli/root.go (root command, quick reference)\n- internal/cli/help.go (colorized help)\n- One file per command group\n- internal/output/json.go, table.go, format.go\n\n## Success Criteria\n1. All commands have --json mode\n2. Quick reference card renders beautifully\n3. Tab completion works (zsh, bash, fish)\n4. Help text is clear and colorized\n5. Error messages are actionable","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-13T18:13:34.084599458-06:00","updated_at":"2025-12-13T18:13:34.084599458-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-7wh","depends_on_id":"simultaneous_launch_button-v0z","type":"blocks","created_at":"2025-12-13T18:13:34.086182396-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7wh","depends_on_id":"simultaneous_launch_button-399","type":"blocks","created_at":"2025-12-13T18:13:34.087162823-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7wh","depends_on_id":"simultaneous_launch_button-qr8","type":"blocks","created_at":"2025-12-13T18:13:34.088078589-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7wh","depends_on_id":"simultaneous_launch_button-3s8","type":"blocks","created_at":"2025-12-13T18:13:34.088961313-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7wh","depends_on_id":"simultaneous_launch_button-jrn","type":"blocks","created_at":"2025-12-13T18:13:34.089922072-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7wh","depends_on_id":"simultaneous_launch_button-kb5","type":"blocks","created_at":"2025-12-13T18:13:34.090841275-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-7wh.1","content_hash":"713584060323371a75737a78fc2e9775152de830ff6deea9f4a09b9c9adb1cab","title":"Implement slb init command","description":"## Task\nImplement the project initialization command.\n\n## Command: slb init [--force]\n\n### What it creates\n\nDirectory structure:\n.slb/\nâ”œâ”€â”€ state.db                    # SQLite database (WAL mode)\nâ”œâ”€â”€ logs/                       # Execution output logs\nâ”œâ”€â”€ pending/                    # Materialized JSON snapshots\nâ”œâ”€â”€ sessions/                   # Active agent sessions\nâ”œâ”€â”€ rollback/                   # Captured state for rollback\nâ”œâ”€â”€ processed/                  # Recently processed requests\nâ””â”€â”€ config.toml                 # Project-specific config\n\n### Logic\n1. Check if .slb/ already exists\n   - Without --force: error \"Already initialized\"\n   - With --force: reinitialize (preserves data)\n2. Create directory structure\n3. Initialize SQLite database with schema\n4. Create default config.toml\n5. Add .slb/ to .gitignore if not present\n6. Output success message\n\n### Default config.toml\nGenerate with sensible defaults and comments explaining each option.\n\n### .gitignore addition\nAppend to existing .gitignore or create new:\n```\n# slb state (don't commit pending requests)\n.slb/\n```\n\n## Files\n- internal/cli/init.go\n\n## Acceptance Criteria\n- [ ] Creates all directories\n- [ ] Initializes SQLite with schema\n- [ ] Creates default config\n- [ ] Updates .gitignore\n- [ ] --force allows reinitialize\n- [ ] JSON output: { initialized_at, project_path }","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:20:26.11762921-06:00","updated_at":"2025-12-13T18:20:26.11762921-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-7wh.1","depends_on_id":"simultaneous_launch_button-v0z.2","type":"blocks","created_at":"2025-12-13T18:20:26.118581243-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7wh.1","depends_on_id":"simultaneous_launch_button-f5d.2","type":"blocks","created_at":"2025-12-13T18:20:26.119399537-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7wh.1","depends_on_id":"simultaneous_launch_button-1c3","type":"blocks","created_at":"2025-12-13T18:20:26.120235324-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-7wh.2","content_hash":"5ff9385344c4f297079e4f0937d746f3ff2b6f26b4c71a24b7ff5738abbefa69","title":"Implement JSON output formatting utilities","description":"## Task\nImplement consistent JSON output formatting for all CLI commands.\n\n## Key Contract (from plan)\n- All JSON keys are snake_case (no camelCase)\n- Timestamps are RFC3339 UTC (e.g., 2025-12-13T14:32:05Z)\n- Human-friendly output to stderr\n- Machine JSON to stdout\n- Streaming commands use NDJSON (one JSON per line)\n\n## Functions (internal/output/)\n\n### output/format.go\n- IsJSON() bool - check if --json flag set\n- SetOutputMode(json bool) - configure mode\n- GetOutputMode() OutputMode\n\n### output/json.go\n- OutputJSON(v any) error\n  - Marshal to stdout with proper formatting\n  - Handle nil values\n- OutputNDJSON(v any) error\n  - Single line JSON for streaming\n- OutputJSONError(err error, code int) error\n  - Structured error output\n\n### output/table.go\n- OutputTable(headers []string, rows [][]string)\n  - go-pretty table formatting\n  - Colorized based on content type\n- OutputList(items []string)\n  - Simple list formatting\n\n### Error JSON Format\n{\n  \"error\": \"error_code\",\n  \"message\": \"Human readable message\",\n  \"details\": { ... }\n}\n\n## Files\n- internal/output/format.go\n- internal/output/json.go\n- internal/output/table.go\n\n## Acceptance Criteria\n- [ ] All JSON uses snake_case\n- [ ] Timestamps are RFC3339 UTC\n- [ ] Human output to stderr\n- [ ] JSON output to stdout\n- [ ] Error format consistent","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:20:41.337199768-06:00","updated_at":"2025-12-13T19:59:45.19009041-06:00","closed_at":"2025-12-13T19:59:45.19009041-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-7wh.2","depends_on_id":"simultaneous_launch_button-f5d.1","type":"blocks","created_at":"2025-12-13T18:20:41.33830165-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7wh.2","depends_on_id":"simultaneous_launch_button-v0z.1","type":"blocks","created_at":"2025-12-13T18:20:41.339241431-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-7wh.3","content_hash":"f10919798f67905941025384d9cce887fbda3ddb4ac150b07fe04575627a670b","title":"Implement graceful degradation when daemon unavailable","description":"## Task\nEnsure slb CLI works even when daemon is not running, with clear messaging.\n\n## Background (from plan)\nCommands should check daemon status before requiring it. When daemon is unavailable:\n- Request still works, just without real-time features\n- Clear warning shown to user\n- File-based polling fallback\n\n## What Works Without Daemon\n- slb init, version, config\n- slb session start/end/list\n- slb request (creates request file, no notifications)\n- slb pending, review, approve, reject\n- slb execute\n- slb patterns *\n- slb history, show\n\n## What Degrades Without Daemon\n- slb watch â†’ falls back to file polling\n- slb tui â†’ works but no real-time updates\n- Desktop notifications disabled\n- Agent Mail notifications disabled\n- Fast IPC unavailable (file polling instead)\n\n## Functions (internal/daemon/client.go)\n\n### IsDaemonRunning() bool\n- Check PID file exists\n- Verify process is alive (kill -0)\n- Try to connect to IPC socket\n\n### WithDaemonOrFallback(fn func(), fallback func())\n- If daemon running: call fn\n- Else: show warning, call fallback\n\n### Common Warning Message\n\"Warning: slb daemon not running. Some features disabled.\nStart daemon with: slb daemon start\nContinuing with file-based polling...\"\n\n## Implementation Points\n1. Check daemon status at start of relevant commands\n2. If unavailable, log warning to stderr\n3. Continue with degraded functionality\n4. Never fail hard just because daemon is down\n\n## Files\n- internal/daemon/client.go\n- Modifications to relevant CLI commands\n\n## Acceptance Criteria\n- [ ] All core commands work without daemon\n- [ ] Clear warning messages shown\n- [ ] File-based fallback works\n- [ ] No hard failures due to missing daemon\n- [ ] slb watch polls files when no daemon","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T18:33:02.223231857-06:00","updated_at":"2025-12-13T19:57:02.573114807-06:00","closed_at":"2025-12-13T19:57:02.573114807-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-7wh.3","depends_on_id":"simultaneous_launch_button-f4c.3","type":"blocks","created_at":"2025-12-13T18:33:02.224207314-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-7wh.4","content_hash":"5ad6da12c2670ac0d90ed08ebf3e4e1742b2aaf178db44e837bf8a2d746e0820","title":"Implement history, show, and version CLI commands","description":"## Task\nImplement the history browsing and detail viewing CLI commands.\n\n## Commands\n\n### slb history\nBrowse and search request history.\n\nFlags:\n- --query/-q: FTS search query\n- --status: Filter by status (pending, approved, rejected, executed, etc.)\n- --agent: Filter by agent name\n- --tier: Filter by risk tier\n- --since: Only show requests after date\n- --limit: Max results (default 50)\n- --format: Output format (table, json)\n\nJSON output: Array of request summaries\n\n### slb show \u003crequest-id\u003e\nShow detailed information about a specific request.\n\nFlags:\n- --with-reviews: Include full review details\n- --with-execution: Include execution details\n- --with-attachments: Include attachment content\n\nJSON output: Full request object with nested data\n\n### slb version\nShow version and build information.\n\nFlags:\n- --json: Output as JSON\n- --check: Check for updates (optional, future)\n\nOutput:\nslb version X.Y.Z\n  Built: 2025-12-13\n  Commit: abc123\n  Go: go1.25\n  Config: ~/.slb/config.toml\n  Project: .slb/state.db\n\nJSON:\n{\n  \"version\": \"X.Y.Z\",\n  \"commit\": \"abc123\",\n  \"build_date\": \"2025-12-13\",\n  \"go_version\": \"go1.25\",\n  \"config_paths\": {...}\n}\n\n## Files\n- internal/cli/history.go\n- internal/cli/show.go\n- internal/cli/version.go\n\n## Acceptance Criteria\n- [ ] history search with FTS works\n- [ ] show displays full details\n- [ ] version shows build info\n- [ ] JSON output for all commands\n- [ ] Filters work correctly","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:33:22.678792898-06:00","updated_at":"2025-12-13T18:33:22.678792898-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-7wh.4","depends_on_id":"simultaneous_launch_button-3s8.1","type":"blocks","created_at":"2025-12-13T18:33:22.679741856-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-7wh.4","depends_on_id":"simultaneous_launch_button-7wh.2","type":"blocks","created_at":"2025-12-13T18:33:22.680615653-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-9ea","content_hash":"39f3c67c4175784b33a08fc00125a9a8527f3c0c04052e92723ffbf744d5a918","title":"Implement webhook notifications for CRITICAL requests","description":"## Task\nImplement webhook notifications for Slack/Discord/etc integration.\n\n## Background (from plan [notifications] section)\nwebhook_url config option allows posting to external services.\n\n## Webhook Payload\nPOST to configured URL with JSON:\n{\n  \"event\": \"critical_request_pending\",\n  \"request_id\": \"req-abc\",\n  \"command\": \"\u003ctruncated\u003e\",\n  \"tier\": \"critical\",\n  \"requestor\": \"AgentName\",\n  \"url\": \"https://...\"\n}\n\n## Configuration\n[notifications]\nwebhook_url = \"https://hooks.slack.com/...\"\n\n## Files\n- internal/daemon/notifications.go (extend)\n\n## Acceptance Criteria\n- [ ] POST sent to webhook_url\n- [ ] Timeout handling\n- [ ] Error logging (don't fail on webhook error)\n- [ ] Configurable per tier","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:48:03.11215245-06:00","updated_at":"2025-12-13T18:48:03.11215245-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-9ea","depends_on_id":"simultaneous_launch_button-f4c.4","type":"blocks","created_at":"2025-12-13T18:48:03.114309618-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-anv","content_hash":"cdd999ca3826657597811cae6a6b3b0f40ce8aad1e24b28a4f154c2754f95258","title":"Implement cross-project review support","description":"## Task\nImplement support for reviewers to see/approve requests from other projects.\n\n## Background (from plan [general] section)\ncross_project_reviews = false  # When true, allows cross-project visibility\nreview_pool = []               # Projects that share a review pool\n\n## Features\n1. slb pending --all-projects: Show requests from all projects\n2. slb pending --review-pool: Show from configured pool only\n3. Review/approve/reject works cross-project\n4. User-level daemon monitors all .slb/ directories\n\n## Configuration\n[general]\ncross_project_reviews = true\nreview_pool = [\"/data/myapp\", \"/data/myapp-infra\"]\n\n## Use Case\nAgent working on myapp-infra can approve dangerous commands from myapp.\n\n## Files\n- internal/db/requests.go (cross-project queries)\n- internal/cli/pending.go (--all-projects, --review-pool flags)\n- internal/daemon/daemon.go (multi-project monitoring)\n\n## Acceptance Criteria\n- [ ] --all-projects shows cross-project requests\n- [ ] --review-pool respects configuration\n- [ ] Approve/reject works cross-project\n- [ ] Daemon watches multiple projects","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:49:02.738652617-06:00","updated_at":"2025-12-13T18:49:02.738652617-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-anv","depends_on_id":"simultaneous_launch_button-3s8.4","type":"blocks","created_at":"2025-12-13T18:49:02.740714267-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-d19","content_hash":"d19d980e88c6c9a67d0889a8e0c831748b6dbb4055dcea3272b3722504e4277c","title":"EPIC: External Integrations","description":"## Overview\nImplement integrations with external tools and platforms: Claude Code hooks, Agent Mail, Cursor rules, etc.\n\n## Background \u0026 Rationale\nslb must integrate into the existing AI coding agent ecosystem. Key integrations:\n1. Claude Code hooks - intercept dangerous commands before execution\n2. MCP Agent Mail - unified coordination channel\n3. Cursor rules - instructions for Cursor agents\n\n## Claude Code Hooks (from plan)\n\nGenerate `.claude/hooks.json`:\n{\n  \"hooks\": {\n    \"pre_bash\": {\n      \"command\": \"slb patterns test --exit-code\",\n      \"input\": { \"command\": \"${COMMAND}\" },\n      \"on_block\": { \"message\": \"This command requires slb approval...\" }\n    }\n  }\n}\n\nThe `--exit-code` flag makes `slb patterns test` return non-zero if approval needed.\n\nCommand: `slb integrations claude-hooks --install`\n\n## Agent Mail Integration\n\nWhen request is created:\n- Send notification to \"SLB-Reviews\" thread\n- Importance based on risk tier\n- Include command, justification, links to approve/reject\n\nSLB-System virtual sender with broadcast to SLB-Broadcast.\n\n## Cursor Rules\n\nGenerate `.cursorrules` section with:\n- Pattern checking instructions\n- Request workflow steps\n- Link to slb documentation\n\nCommand: `slb integrations cursor-rules --install`\n\n## Files\n- internal/integrations/agentmail.go\n- internal/integrations/claudehooks.go\n- internal/integrations/cursor.go\n- internal/cli/integrations.go\n\n## Success Criteria\n1. Claude Code hooks generated correctly\n2. Agent Mail messages sent on request creation\n3. Cursor rules generate proper markdown\n4. All integrations are optional and configurable","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-13T18:14:34.665328919-06:00","updated_at":"2025-12-13T18:14:34.665328919-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-d19","depends_on_id":"simultaneous_launch_button-7wh","type":"blocks","created_at":"2025-12-13T18:14:34.666659698-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-d19.1","content_hash":"310326ffe173bf80261cbff86daf2d0b4003539f34f7c9f89c9240306bc27535","title":"Implement Claude Code hooks generator","description":"## Task\nImplement generator for Claude Code pre_bash hooks.\n\n## Command: slb integrations claude-hooks --install\n\n## Generated Hook (.claude/hooks.json)\n{\n  \"hooks\": {\n    \"pre_bash\": {\n      \"command\": \"slb patterns test --exit-code\",\n      \"input\": {\n        \"command\": \"${COMMAND}\"\n      },\n      \"on_block\": {\n        \"message\": \"This command requires slb approval. Use: slb request \\\"${COMMAND}\\\" --reason \\\"...\\\" --expected-effect \\\"...\\\" --goal \\\"...\\\" --safety \\\"...\\\"\"\n      }\n    }\n  }\n}\n\n## How it Works\n1. `slb patterns test --exit-code` returns:\n   - 0 if command doesn't need approval\n   - 1 if command needs approval\n2. Claude Code intercepts exit code 1\n3. Shows on_block message to agent\n4. Agent must use slb workflow\n\n## Options\n- --install: Write to .claude/hooks.json\n- --preview: Show what would be written\n- --merge: Merge with existing hooks.json\n\n## Files\n- internal/integrations/claudehooks.go\n- internal/cli/integrations.go\n\n## Acceptance Criteria\n- [ ] Generates valid hooks.json\n- [ ] Merges with existing hooks\n- [ ] Creates .claude/ directory\n- [ ] Preview mode works","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T18:26:17.694676008-06:00","updated_at":"2025-12-13T20:09:52.591580546-06:00","closed_at":"2025-12-13T20:09:52.591580546-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-d19.1","depends_on_id":"simultaneous_launch_button-qr8.3","type":"blocks","created_at":"2025-12-13T18:26:17.695639883-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-d19.2","content_hash":"a78aea21c4c2f00f7ae5dbe7189ed7e8784a9f6bb8274eae2202f82ca4b1fd43","title":"Implement Agent Mail integration","description":"## Task\nImplement Agent Mail integration for cross-agent notifications.\n\n## When Request Created\nSend notification to SLB-Reviews thread with:\n- Command (truncated/redacted)\n- Risk tier\n- Requestor info\n- Justification summary\n- Links to approve/reject\n\n## Message Format (from plan)\n{\n  \"project_key\": \"\u003cproject_path\u003e\",\n  \"sender_name\": \"SLB-System\",\n  \"to\": [\"SLB-Broadcast\"],\n  \"subject\": \"[SLB] DANGEROUS: rm -rf ./build...\",\n  \"body_md\": \"## Command Approval Request\\n\\n**ID**: req-abc\\n**Risk**: dangerous\\n**Command**: `rm -rf ./build`\\n\\n### Justification\\n...\\n\\n---\\nTo review: `slb review req-abc`\\nTo approve: `slb approve req-abc --session-id \u003cyour-session\u003e`\",\n  \"importance\": \"normal\",\n  \"thread_id\": \"SLB-Reviews\"\n}\n\n## Importance Mapping\n- CRITICAL â†’ \"urgent\"\n- DANGEROUS â†’ \"normal\"\n- CAUTION â†’ \"low\"\n\n## Functions (internal/integrations/agentmail.go)\n\n### NewAgentMailClient(projectKey string) (*AgentMailClient, error)\n- Initialize MCP client connection\n\n### NotifyNewRequest(req *Request) error\n- Format message\n- Send via Agent Mail MCP\n\n### NotifyRequestApproved(req *Request, review *Review) error\n### NotifyRequestRejected(req *Request, review *Review) error\n### NotifyRequestExecuted(req *Request, result *ExecutionResult) error\n\n## Configuration\n[integrations]\nagent_mail_enabled = true\nagent_mail_thread = \"SLB-Reviews\"\n\n## Files\n- internal/integrations/agentmail.go\n\n## Acceptance Criteria\n- [ ] Notifications sent on request creation\n- [ ] Thread grouping works\n- [ ] Importance set correctly\n- [ ] Redacted commands in messages\n- [ ] Configurable enable/disable","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:26:33.636090057-06:00","updated_at":"2025-12-13T18:26:33.636090057-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-d19.2","depends_on_id":"simultaneous_launch_button-3s8.3","type":"blocks","created_at":"2025-12-13T18:26:33.636990294-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-d19.3","content_hash":"68b7d579acb025c722a2b7a19f31e143abb4ac8eafc86d44c399de28eef192b8","title":"Implement Cursor rules generator","description":"## Task\nImplement generator for Cursor IDE rules (.cursorrules).\n\n## Command: slb integrations cursor-rules --install\n\n## Generated Content\nAppends to or creates .cursorrules file with:\n\n```markdown\n## Dangerous Command Policy (slb)\n\nBefore running any command that might be destructive, you MUST use slb for approval:\n\n1. Check if command needs approval:\n   \\`slb patterns test \"\u003ccommand\u003e\"\\`\n\n2. If approval needed, request it:\n   \\`slb request \"\u003ccommand\u003e\" --reason \"...\" --expected-effect \"...\" --goal \"...\" --safety \"...\"\\`\n\n3. Wait for approval:\n   \\`slb status \u003crequest-id\u003e --wait\\`\n\n4. Execute only when approved:\n   \\`slb execute \u003crequest-id\u003e\\`\n\n### Risk Tiers\n- ğŸ”´ CRITICAL: Requires 2+ approvals (DROP DATABASE, terraform destroy)\n- ğŸŸ  DANGEROUS: Requires 1 approval (rm -rf, git reset --hard)\n- ğŸŸ¡ CAUTION: Auto-approved after 30s (rm *.log, git branch -d)\n\n### Quick Reference\n- Start session: \\`slb session start --agent \"\u003cname\u003e\" --program \"cursor\" --model \"\u003cmodel\u003e\"\\`\n- Atomic run: \\`slb run \"\u003ccommand\u003e\" --reason \"...\"\\`\n- Check pending: \\`slb pending\\`\n\nNever bypass slb for dangerous commands. The point is peer review.\n```\n\n## Options\n- --install: Write to .cursorrules\n- --preview: Show what would be written\n- --append: Append to existing (default)\n- --replace: Replace existing slb section\n\n## Files\n- internal/integrations/cursor.go\n- internal/cli/integrations.go (update)\n\n## Acceptance Criteria\n- [ ] Generates valid .cursorrules content\n- [ ] Appends correctly to existing file\n- [ ] Preview mode works\n- [ ] Content includes all key instructions","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:33:39.692087451-06:00","updated_at":"2025-12-13T18:33:39.692087451-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-d19.3","depends_on_id":"simultaneous_launch_button-qr8.3","type":"blocks","created_at":"2025-12-13T18:33:39.69303687-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-ei2","content_hash":"8c2507d5401f69822fc205c6f37f8ac5312144db6b888fa49bc40d9e764032ae","title":"Implement TCP listener for Docker/remote agents","description":"## Task\nImplement optional TCP listener for agents that can't access Unix socket.\n\n## Background (from plan [daemon] section)\nDocker agents can't access host Unix socket. TCP allows remote connection.\n\n## Configuration\n[daemon]\ntcp_addr = \"127.0.0.1:3333\"     # Empty = disabled\ntcp_require_auth = true          # Require session key in handshake\ntcp_allowed_ips = [\"127.0.0.1\", \"172.17.0.0/16\"]  # Docker bridge\n\n## Protocol\nSame JSON-RPC as Unix socket, but with auth handshake:\n1. Client connects\n2. Client sends: {\"auth\": \"session_key_here\"}\n3. Server validates, starts accepting requests\n\n## SLB_HOST Environment Variable\nAgents in Docker use: SLB_HOST=host.docker.internal:3333\n\n## Files\n- internal/daemon/ipc.go (extend)\n- internal/daemon/tcp.go\n\n## Acceptance Criteria\n- [ ] TCP listener starts on configured port\n- [ ] Auth handshake works\n- [ ] IP whitelist enforced\n- [ ] Falls back to Unix socket if TCP unavailable","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:48:50.373321179-06:00","updated_at":"2025-12-13T18:48:50.373321179-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-ei2","depends_on_id":"simultaneous_launch_button-f4c.3","type":"blocks","created_at":"2025-12-13T18:48:50.375493696-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-f4c","content_hash":"581cfcba748cfbb45e5817d54480c2ff7eedede500396785f897f266595043d0","title":"EPIC: Daemon \u0026 IPC System","description":"## Overview\nImplement the background daemon that watches for state changes and provides fast IPC for agent communication.\n\n## Background \u0026 Rationale\nThe daemon provides:\n- File system watching (not polling!) for real-time notifications\n- Unix socket IPC for fast communication\n- Optional TCP listener for Docker/remote agents\n- Desktop notifications for CRITICAL requests\n- Timeout handling and escalation\n\nKey v2.0.0 decision: The daemon is a NOTARY, not an executor. It verifies approvals but doesn't run commands.\n\n## Key Commands (from plan)\n- `slb daemon start [--foreground]`\n- `slb daemon stop`\n- `slb daemon status`\n- `slb daemon logs [--follow] [--lines N]`\n\n## Key Design Decisions\n1. **Single Binary**: `slb daemon start` forks subprocess with SLB_DAEMON_MODE=1\n2. **File Watching**: fsnotify (inotify/FSEvents/ReadDirectoryChangesW)\n3. **Unix Socket**: /tmp/slb-{project-hash}.sock\n4. **TCP Support**: Optional, for Docker agents (tcp_addr, tcp_require_auth, tcp_allowed_ips)\n5. **PID File**: /tmp/slb-daemon-{user}.pid for single-instance\n6. **Graceful Degradation**: CLI works without daemon (just slower)\n\n## Watch Mode (for reviewing agents)\n- `slb watch --session-id \u003cid\u003e [--json]` â†’ NDJSON stream\n- Non-interactive, outputs events for agent consumption\n- Events: request_pending, request_approved, request_rejected, etc.\n\n## Notifications\n- Desktop: osascript (macOS), notify-send (Linux), PowerShell toast (Windows)\n- Webhook: Slack/Discord integration\n- Email: Optional SMTP\n\n## Files\n- internal/daemon/daemon.go (lifecycle)\n- internal/daemon/watcher.go (fsnotify)\n- internal/daemon/ipc.go (Unix socket)\n- internal/daemon/notifications.go\n- internal/daemon/verifier.go (approval verification)\n- internal/cli/daemon.go, watch.go\n\n## Success Criteria\n1. Daemon starts/stops cleanly\n2. File watching works on Linux/macOS\n3. Unix socket IPC functional\n4. Desktop notifications appear for CRITICAL\n5. Graceful degradation when daemon down","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-13T18:13:12.155207378-06:00","updated_at":"2025-12-13T18:13:12.155207378-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-f4c","depends_on_id":"simultaneous_launch_button-f5d","type":"blocks","created_at":"2025-12-13T18:13:12.156555699-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-f4c.1","content_hash":"7902de534daf5b15c061f5c86ed1f7ddff58d0f547c0827e6252da62766532cd","title":"Implement daemon lifecycle management","description":"## Task\nImplement the daemon process that watches for state changes.\n\n## Key Design Decision\nSingle binary architecture: `slb daemon start` forks a subprocess with SLB_DAEMON_MODE=1 environment variable.\n\n## Functions (internal/daemon/daemon.go)\n\n### StartDaemon() error\n1. Check if daemon already running (PID file)\n2. If called directly (SLB_DAEMON_MODE=1), run daemon logic\n3. If called from CLI, fork subprocess:\n   - cmd := exec.Command(os.Args[0], \"daemon\", \"start\")\n   - cmd.Env = append(os.Environ(), \"SLB_DAEMON_MODE=1\")\n   - cmd.Start()\n   - cmd.Process.Release() // Detach\n4. Write PID file\n5. Start file watchers\n6. Start IPC server\n7. Start notification handler\n\n### StopDaemon() error\n- Read PID file\n- Send SIGTERM\n- Wait for graceful shutdown\n- Remove PID file\n\n### DaemonStatus() (*DaemonInfo, error)\n- Check PID file\n- Verify process is running\n- Return status info\n\n### runDaemon() (main loop)\n- Initialize logging\n- Set up signal handlers (SIGTERM, SIGINT)\n- Start watchers for .slb/state.db changes\n- Listen on IPC socket\n- Handle timeout checking\n- Graceful shutdown on signal\n\n## Files\n- internal/daemon/daemon.go\n- PID file: /tmp/slb-daemon-{user}.pid\n- Log file: ~/.slb/daemon.log\n\n## Acceptance Criteria\n- [ ] Daemon forks correctly\n- [ ] PID file prevents duplicates\n- [ ] Signal handlers work\n- [ ] Graceful shutdown on SIGTERM\n- [ ] Log file created","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:21:39.149941653-06:00","updated_at":"2025-12-13T18:21:39.149941653-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-f4c.1","depends_on_id":"simultaneous_launch_button-v0z.2","type":"blocks","created_at":"2025-12-13T18:21:39.15085791-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-f4c.1","depends_on_id":"simultaneous_launch_button-1c3","type":"blocks","created_at":"2025-12-13T18:21:39.151687014-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-f4c.2","content_hash":"635d3fe2671ac9419cc14456c10438baabc860bb6d8ccecad0a00c838191a44f","title":"Implement file system watcher using fsnotify","description":"## Task\nImplement file system watching using fsnotify for real-time event detection.\n\n## Why Not Polling\nThe original plan mentioned polling which is wasteful. fsnotify uses:\n- inotify on Linux\n- FSEvents on macOS\n- ReadDirectoryChangesW on Windows\n\nOnly wakes up when files actually change.\n\n## What to Watch\n- .slb/state.db (SQLite changes)\n- .slb/pending/ (new request files for interop)\n- .slb/sessions/ (session file changes)\n\n## Functions (internal/daemon/watcher.go)\n\n### NewWatcher(projectPath string) (*Watcher, error)\n- Initialize fsnotify watcher\n- Add paths to watch\n- Return watcher handle\n\n### (w *Watcher) Start(ctx context.Context) error\n- Start goroutine for event loop\n- Handle events:\n  - CREATE: new pending request â†’ notify reviewers\n  - MODIFY: state change â†’ update TUI, check transitions\n  - DELETE: cleanup or processed\n- Handle errors (reconnect on transient failures)\n\n### (w *Watcher) Stop() error\n- Close watcher\n- Stop goroutines\n\n## Event Debouncing\nSQLite WAL writes multiple times per change. Debounce with:\n- 100ms window for same-file events\n- Batch multiple changes into single notification\n\n## Cross-Platform Considerations\n- Linux inotify has event coalescing built-in\n- macOS FSEvents can be high-latency; tune kqueue for low latency\n- Windows has good support but different event semantics\n\n## Files\n- internal/daemon/watcher.go\n\n## Acceptance Criteria\n- [ ] Watcher detects file changes in real-time\n- [ ] Debouncing prevents event floods\n- [ ] Graceful cleanup on shutdown\n- [ ] Works on Linux and macOS","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:21:57.259731795-06:00","updated_at":"2025-12-13T18:21:57.259731795-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-f4c.2","depends_on_id":"simultaneous_launch_button-f4c.1","type":"blocks","created_at":"2025-12-13T18:21:57.26069559-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-f4c.3","content_hash":"444706b9bce743f21c31e5217c506e6902f9a52f170673f9b797d1143b5094a3","title":"Implement Unix socket IPC server","description":"## Task\nImplement Unix domain socket IPC for fast agent communication with daemon.\n\n## Socket Location\n/tmp/slb-{project-hash}.sock\n\n## Protocol\nSimple JSON-RPC style:\n- Request: { \"method\": \"...\", \"params\": {...}, \"id\": 1 }\n- Response: { \"result\": {...}, \"error\": null, \"id\": 1 }\n\n## Methods\n\n### subscribe\n- Subscribe to events for this session\n- Returns: stream of events\n\n### notify\n- Send notification to daemon\n- Params: { type, payload }\n\n### status\n- Get daemon status\n- Returns: { uptime, pending_count, active_sessions }\n\n### ping\n- Health check\n- Returns: { pong: true }\n\n## Functions (internal/daemon/ipc.go)\n\n### NewIPCServer(socketPath string) (*IPCServer, error)\n- Create Unix socket listener\n- Set permissions (0600)\n\n### (s *IPCServer) Start(ctx context.Context) error\n- Accept connections\n- Handle each in goroutine\n- Parse JSON-RPC, dispatch to handlers\n\n### (s *IPCServer) Stop() error\n- Close listener\n- Cleanup socket file\n\n## Optional: TCP Support\nFor Docker agents that can't access host Unix socket:\n- tcp_addr config option (e.g., \"127.0.0.1:3333\")\n- tcp_require_auth: require session key in handshake\n- tcp_allowed_ips: whitelist for security\n\n## Files\n- internal/daemon/ipc.go\n\n## Acceptance Criteria\n- [ ] Socket created with correct permissions\n- [ ] JSON-RPC protocol works\n- [ ] Multiple clients supported\n- [ ] Graceful shutdown closes socket\n- [ ] TCP fallback works (optional)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:22:13.024914142-06:00","updated_at":"2025-12-13T18:22:13.024914142-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-f4c.3","depends_on_id":"simultaneous_launch_button-f4c.1","type":"blocks","created_at":"2025-12-13T18:22:13.025858381-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-f4c.4","content_hash":"4fb6aaf648ccf518864b0e0a0478eb0e056c6b1ff2b3d6d41a557ef950813818","title":"Implement desktop notifications","description":"## Task\nImplement desktop notifications for CRITICAL pending requests.\n\n## Platform Support\n\n### macOS\nUse osascript:\nosascript -e 'display notification \"message\" with title \"title\"'\n\n### Linux\nUse notify-send:\nnotify-send \"title\" \"message\"\n\n### Windows\nUse PowerShell toast:\n[Windows.UI.Notifications.ToastNotificationManager]::...\n\n## When to Notify\n- CRITICAL request pending for \u003e desktop_delay_seconds (default 60s)\n- Request timeout approaching\n- Escalation to human\n\n## Functions (internal/daemon/notifications.go)\n\n### SendDesktopNotification(title, message string) error\n- Detect platform\n- Execute appropriate command\n- Return error if unsupported\n\n### CheckPendingNotifications() error\n- Called periodically by daemon\n- Find CRITICAL requests pending \u003e threshold\n- Send notification for each (debounced)\n\n### Platform Detection\n- runtime.GOOS == \"darwin\" â†’ macOS\n- runtime.GOOS == \"linux\" â†’ Linux\n- runtime.GOOS == \"windows\" â†’ Windows\n\n## Configuration\n[notifications]\ndesktop_enabled = true\ndesktop_delay_seconds = 60\n\n## Files\n- internal/daemon/notifications.go\n\n## Acceptance Criteria\n- [ ] macOS notifications work\n- [ ] Linux notifications work\n- [ ] Windows notifications work (or graceful fallback)\n- [ ] Debouncing prevents spam\n- [ ] Configurable delay","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:22:26.864968573-06:00","updated_at":"2025-12-13T18:22:26.864968573-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-f4c.4","depends_on_id":"simultaneous_launch_button-f4c.1","type":"blocks","created_at":"2025-12-13T18:22:26.865955882-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-f4c.5","content_hash":"40cb1ed15a0860a1564fca8944c1b70f347bf54f1253564a0ecc16d2655c770a","title":"Implement slb watch command for reviewing agents","description":"## Task\nImplement the watch command for reviewing agents to monitor pending requests.\n\n## Command: slb watch\n- Flags: --project/-C\n- Flags: --session-id/-s\n- Flags: --auto-approve-caution (auto-approve CAUTION tier)\n- Flags: --json (NDJSON stream)\n\n## Behavior\n- Non-interactive (no TUI prompts)\n- Outputs NDJSON events, one per line\n- Agent can parse events and react programmatically\n- Blocks and streams until Ctrl-C\n\n## Event Types\n{\n  \"event\": \"request_pending\",\n  \"request_id\": \"req-...\",\n  \"risk_tier\": \"dangerous\",\n  \"command\": \"rm -rf ./build\",\n  \"requestor\": \"GreenLake\",\n  \"created_at\": \"...\"\n}\n\n{\n  \"event\": \"request_approved\",\n  \"request_id\": \"req-...\",\n  \"approved_by\": \"BlueDog\"\n}\n\n{\n  \"event\": \"request_rejected\",\n  \"request_id\": \"req-...\",\n  \"rejected_by\": \"BlueDog\",\n  \"reason\": \"...\"\n}\n\n{\n  \"event\": \"request_executed\",\n  \"request_id\": \"req-...\",\n  \"exit_code\": 0\n}\n\n## Implementation\n1. Connect to daemon IPC\n2. Subscribe to events\n3. Stream NDJSON to stdout\n4. If --auto-approve-caution, auto-approve matching requests\n\n## Files\n- internal/cli/watch.go\n\n## Acceptance Criteria\n- [ ] NDJSON output works\n- [ ] Events match specification\n- [ ] --auto-approve-caution works\n- [ ] Graceful shutdown on SIGINT","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:22:47.314370739-06:00","updated_at":"2025-12-13T18:22:47.314370739-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-f4c.5","depends_on_id":"simultaneous_launch_button-f4c.2","type":"blocks","created_at":"2025-12-13T18:22:47.315314687-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-f4c.5","depends_on_id":"simultaneous_launch_button-f4c.3","type":"blocks","created_at":"2025-12-13T18:22:47.316157487-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-f4c.5","depends_on_id":"simultaneous_launch_button-v0z.2","type":"blocks","created_at":"2025-12-13T18:22:47.31699114-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-f4c.6","content_hash":"fbfd64e10b48cbeb2046e75960ac05867899a8db17f8ea52ea4ca779bb5a4d9e","title":"Implement daemon CLI commands","description":"## Task\nImplement CLI commands for managing the daemon.\n\n## Commands (internal/cli/daemon.go)\n\n### slb daemon start\n- Flags: --foreground (don't fork, run in current process)\n- Starts daemon if not running\n- Returns JSON: { pid, socket_path, started_at }\n- Error if already running\n\n### slb daemon stop\n- Sends SIGTERM to daemon\n- Waits for graceful shutdown\n- Returns JSON: { stopped_at }\n- Error if not running\n\n### slb daemon status\n- Checks if daemon running\n- Returns JSON: { running, pid, uptime, pending_count, active_sessions, socket_path }\n\n### slb daemon logs\n- Flags: --follow/-f (tail follow mode)\n- Flags: --lines/-n (number of lines)\n- Shows daemon log file contents\n- JSON mode: returns log entries as array\n\n## Graceful Degradation\nWhen daemon is not running:\n- CLI commands still work (file-based, slower)\n- Warning message shown\n- No desktop notifications\n- No real-time TUI updates\n\n## Files\n- internal/cli/daemon.go\n\n## Acceptance Criteria\n- [ ] start/stop/status work correctly\n- [ ] logs command shows output\n- [ ] Graceful degradation message shown\n- [ ] JSON output for all commands","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:23:01.374774628-06:00","updated_at":"2025-12-13T18:23:01.374774628-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-f4c.6","depends_on_id":"simultaneous_launch_button-f4c.1","type":"blocks","created_at":"2025-12-13T18:23:01.375708116-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-f4c.6","depends_on_id":"simultaneous_launch_button-v0z.2","type":"blocks","created_at":"2025-12-13T18:23:01.376666982-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-f4c.7","content_hash":"bb7e64b02c8481ed7706723b36e2165d9a179dc2b27214fbd478af34a84c996a","title":"Implement request timeout handler in daemon","description":"## Task\nImplement the background timeout checker that transitions expired pending requests.\n\n## Background\nPending requests have an expires_at timestamp. If no approval/rejection is received before expiry, the request should transition to TIMEOUT state and optionally ESCALATE to human.\n\n## Functions (internal/daemon/timeout.go)\n\n### StartTimeoutChecker(ctx context.Context, interval time.Duration)\n- Run in goroutine\n- Every interval (default 10s), check for expired requests\n- For each expired request:\n  1. Transition to TIMEOUT state\n  2. If escalation enabled, send desktop notification\n  3. Transition to ESCALATED state\n  4. Log the timeout\n\n### CheckExpiredRequests() ([]Request, error)\n- Query: SELECT * FROM requests WHERE status = 'pending' AND expires_at \u003c now()\n- Return list of expired requests\n\n### HandleExpiredRequest(req *Request) error\n- Transition to TIMEOUT\n- If config.timeout_action == \"escalate\":\n  - Send notification\n  - Transition to ESCALATED\n- If config.timeout_action == \"cancel\":\n  - Transition to CANCELLED\n\n## Configuration\n[general]\nrequest_timeout = 1800  # 30 min default\ntimeout_action = \"escalate\"  # or \"cancel\"\n\n## Files\n- internal/daemon/timeout.go\n\n## Acceptance Criteria\n- [ ] Expired requests detected within interval\n- [ ] State transitions correct\n- [ ] Escalation notifications sent\n- [ ] Configurable behavior","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:32:12.660887588-06:00","updated_at":"2025-12-13T18:32:12.660887588-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-f4c.7","depends_on_id":"simultaneous_launch_button-f4c.1","type":"blocks","created_at":"2025-12-13T18:32:12.661840182-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-f4c.7","depends_on_id":"simultaneous_launch_button-3s8.2","type":"blocks","created_at":"2025-12-13T18:32:12.662744246-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-f4c.8","content_hash":"4c5277eae6de0a55856f7825fa6c53ff0d370a4a953e7c86e2788d61d6bcb840","title":"Implement daemon verifier for execution gate conditions","description":"## Task\nImplement the daemon's verification logic that validates execution is allowed.\n\n## Background (v2.0.0)\nThe daemon is a NOTARY, not an executor. When a client wants to execute an approved request, the daemon verifies all gate conditions are met but the actual command runs client-side.\n\n## Execution Gate Conditions (all must pass)\n1. Request status is APPROVED\n2. approval_expires_at has not elapsed (30min default, 10min for CRITICAL)\n3. command_hash still matches (no mutation since approval)\n4. Current pattern policy doesn't raise required tier\n5. First successful executor wins (idempotent)\n\n## Functions (internal/daemon/verifier.go)\n\n### VerifyExecutionAllowed(requestID, sessionID string) (*VerificationResult, error)\nReturns:\n- Allowed: bool\n- Reason: string (if not allowed)\n- Request: *Request (if allowed)\n- ApprovalRemainingSeconds: int\n\nChecks:\n1. Get request from DB\n2. Check status == APPROVED\n3. Check approval_expires_at \u003e now()\n4. Check command_hash matches current request\n5. Check min_approvals still satisfied by current pattern config\n6. Mark request as EXECUTING (first wins)\n\n### VerifyAndMarkExecuting(requestID, sessionID string) (*Request, error)\n- Atomic operation\n- Returns request if verification passed\n- Error if any check fails\n\n### RevertExecutingOnFailure(requestID string) error\n- If execution fails before command starts, revert to APPROVED\n- Only if approval hasn't expired\n\n## IPC Method\n```json\n{\n  \"method\": \"verify_execute\",\n  \"params\": {\n    \"request_id\": \"req-abc\",\n    \"session_id\": \"sess-123\"\n  }\n}\n```\n\nResponse:\n```json\n{\n  \"allowed\": true,\n  \"request\": {...},\n  \"approval_remaining_seconds\": 1200\n}\n```\n\n## Files\n- internal/daemon/verifier.go\n\n## Acceptance Criteria\n- [ ] All gate conditions checked\n- [ ] Clear error messages for each failure mode\n- [ ] Atomic state transition to EXECUTING\n- [ ] First executor wins (idempotent)\n- [ ] Approval expiry checked","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-13T18:34:00.11690445-06:00","updated_at":"2025-12-13T18:34:00.11690445-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-f4c.8","depends_on_id":"simultaneous_launch_button-f4c.3","type":"blocks","created_at":"2025-12-13T18:34:00.117915252-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-f4c.8","depends_on_id":"simultaneous_launch_button-jrn.2","type":"blocks","created_at":"2025-12-13T18:34:00.118844874-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-f5d","content_hash":"57a7c8a3c60e6afb1fa819d8e48484dcc47a258673cfb733508f114b20c2cfb2","title":"EPIC: Core Domain Types \u0026 SQLite Schema","description":"## Overview\nDefine the core data structures and SQLite schema that form the heart of slb. This includes Go types and database tables for sessions, requests, reviews, patterns, and execution outcomes.\n\n## Background \u0026 Rationale\nThe plan (v2.0.0) specifies SQLite as the authoritative source of truth, with JSON files as materialized views. Key types include:\n- Session: agent identity with HMAC session key\n- CommandSpec: structured command with hash binding for security\n- Request: the command approval request with justification\n- Review: approval/rejection with signature\n- Pattern: regex-based command classification\n\n## Key Design Decisions\n1. **Single Source of Truth**: `.slb/state.db` is authoritative, not JSON files\n2. **CommandSpec with Hash**: Approvals bind to exact command via sha256 hash\n3. **FTS5 for Search**: External content table mode with triggers for sync\n4. **Partial Unique Index**: Only one active session per agent+project\n5. **snake_case JSON**: Stable API contract for agent consumption\n\n## SQLite Schema (from plan)\n- sessions: agent sessions with HMAC keys\n- requests: command approval requests\n- reviews: approvals/rejections with signatures\n- requests_fts: full-text search (external content)\n- execution_outcomes: analytics/learning\n- pattern_changes: audit trail for pattern modifications\n- custom_patterns: agent-added patterns\n\n## Go Types (internal/db/)\n- RiskTier enum: critical, dangerous, caution\n- RequestStatus enum: pending, approved, executing, executed, etc.\n- Session, Request, Review, CommandSpec, Justification, etc.\n\n## State Machine\nRequest lifecycle: CREATED â†’ PENDING â†’ APPROVED/REJECTED â†’ EXECUTING â†’ EXECUTED/EXECUTION_FAILED\n\n## Success Criteria\n1. All types compile with correct JSON tags (snake_case)\n2. Schema creates tables with proper indexes\n3. FTS triggers maintain sync\n4. State machine transitions are enforced","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-13T18:11:22.041942988-06:00","updated_at":"2025-12-13T19:41:42.344837375-06:00","closed_at":"2025-12-13T19:41:42.344837375-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-f5d","depends_on_id":"simultaneous_launch_button-v0z","type":"blocks","created_at":"2025-12-13T18:11:22.044137486-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-f5d.1","content_hash":"9bc539e3aedda704e806fb2c5046a9e8529e1da46b8a0bec52f4816a880ae17f","title":"Implement Go type definitions for core domain","description":"## Task\nDefine all Go types from the plan's schema section.\n\n## Types to Implement (internal/db/types.go)\n\n### Enums\n- RiskTier: critical, dangerous, caution\n- RequestStatus: pending, approved, executing, executed, execution_failed, cancelled, timeout, timed_out, escalated\n\n### Structs\n\n#### Session\n- ID, AgentName, Program, Model, ProjectPath\n- SessionKey (not serialized in JSON)\n- StartedAt, LastActiveAt, EndedAt\n\n#### CommandSpec\n- Raw (exactly what agent requested)\n- Argv (parsed, preferred for execution)\n- Cwd (working directory at request time)\n- Shell (bool)\n- Hash (sha256 of all above)\n- DisplayRedacted (redacted version for display)\n- ContainsSensitive (bool)\n\n#### Justification\n- Reason (required)\n- ExpectedEffect, Goal, SafetyArgument (optional)\n\n#### Request\n- ID, ProjectPath, Command (CommandSpec), RiskTier\n- Requestor, Justification, DryRun, Attachments\n- Status, MinApprovals, RequireDifferentModel\n- Execution, Rollback\n- CreatedAt, ResolvedAt, ExpiresAt, ApprovalExpiresAt\n\n#### Review\n- ID, RequestID, Reviewer\n- Decision, Signature, SignatureTimestamp\n- Responses, Comments, CreatedAt\n\n#### Attachment\n- Type, Content, Metadata\n\n## JSON Tags\nAll snake_case as per stable API contract.\n\n## Files\n- internal/db/types.go\n- internal/db/enums.go\n\n## Acceptance Criteria\n- [ ] All types compile\n- [ ] JSON serialization uses snake_case\n- [ ] Time fields use time.Time\n- [ ] Pointer types for optional fields","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T18:16:05.001947359-06:00","updated_at":"2025-12-13T19:28:23.926093172-06:00","closed_at":"2025-12-13T19:28:23.926093172-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-f5d.1","depends_on_id":"simultaneous_launch_button-v0z.1","type":"blocks","created_at":"2025-12-13T18:16:05.003011852-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-f5d.2","content_hash":"e734d4d72d6f618b8e6550efe26bcd305c434da57c02cf4a58852618c639e72b","title":"Implement SQLite schema with migrations","description":"## Task\nCreate SQLite schema as defined in the plan, with migration support.\n\n## Schema Components\n\n### Tables\n1. **sessions** - Agent sessions with HMAC keys\n   - Partial unique index for one active session per agent+project\n   - Index on last_active_at for cleanup queries\n\n2. **requests** - Command approval requests\n   - command_hash for binding approval to exact command\n   - Indexes on status, project_path, created_at\n\n3. **reviews** - Approvals/rejections\n   - Unique on (request_id, reviewer_session_id)\n   - Foreign keys to sessions and requests\n\n4. **requests_fts** - Full-text search (FTS5)\n   - External content table mode\n   - Triggers for INSERT/UPDATE/DELETE sync\n\n5. **execution_outcomes** - Analytics data\n   - Links to requests\n\n6. **pattern_changes** - Audit trail for pattern modifications\n   - Indexes on status and change_type\n\n7. **custom_patterns** - Agent-added patterns\n   - Unique on (tier, pattern)\n\n### Key SQLite Features\n- WAL mode for concurrency\n- FTS5 for search\n- External content tables\n- Partial unique indexes (WHERE ended_at IS NULL)\n\n## Migration Strategy\n- internal/db/migrations/ with numbered SQL files\n- Version tracking in DB\n- Support for up migrations only (no down for simplicity)\n\n## Files\n- internal/db/schema.go (schema constants)\n- internal/db/migrations.go (migration runner)\n- internal/db/db.go (connection management)\n\n## Acceptance Criteria\n- [ ] Schema creates all tables\n- [ ] FTS triggers work correctly\n- [ ] Partial unique index prevents duplicate active sessions\n- [ ] WAL mode enabled\n- [ ] Migrations are versioned","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T18:16:21.149414679-06:00","updated_at":"2025-12-13T19:48:07.379509881-06:00","closed_at":"2025-12-13T19:48:07.379509881-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-f5d.2","depends_on_id":"simultaneous_launch_button-f5d.1","type":"blocks","created_at":"2025-12-13T18:16:21.150592693-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-jrn","content_hash":"39803fd03446005ae55d9d1604442b2fa3a315404a094fe901cb9b57701902e4","title":"EPIC: Review \u0026 Approval System","description":"## Overview\nImplement the review system - how other agents evaluate and approve/reject requests.\n\n## Background \u0026 Rationale\nThe \"two-person rule\" is the heart of slb. A second agent must independently evaluate:\n- Does the justification make sense?\n- Is the expected effect accurate?\n- Does this align with project rules?\n- Is there a safer alternative?\n\nReviews include structured responses to each justification field and are cryptographically signed.\n\n## Key Commands (from plan)\n- `slb review \u003crequest-id\u003e` â†’ show full details\n- `slb review \u003cid1\u003e \u003cid2\u003e \u003cid3\u003e --json` â†’ bulk review\n- `slb approve \u003crequest-id\u003e --session-id \u003cid\u003e [--reason-response \"...\"] [--comment \"...\"]`\n- `slb approve \u003cid1\u003e \u003cid2\u003e \u003cid3\u003e` â†’ bulk approve (same tier only)\n- `slb reject \u003crequest-id\u003e --session-id \u003cid\u003e --reason \"...\"`\n\n## Key Design Decisions\n1. **No Self-Approval**: requestor_session_id != reviewer_session_id enforced\n2. **HMAC Signature**: HMAC-SHA256(session_key, request_id || decision || timestamp)\n3. **Timestamp in Signature**: Prevents replay (must be within 5 minutes)\n4. **Conflict Resolution**: Configurable - any_rejection_blocks (default), first_wins, human_breaks_tie\n5. **Different Model Requirement**: Optional, advisory (honor system)\n6. **Bulk Operations**: Only for same tier (safety check)\n\n## Structured Review Responses\n- reason_response: Response to the \"why\" \n- effect_response: Response to expected effect\n- goal_response: Response to goal\n- safety_response: Response to safety argument\n- comments: Additional notes\n\n## Files\n- internal/core/review.go\n- internal/core/signature.go\n- internal/db/reviews.go\n- internal/cli/review.go, approve.go, reject.go\n\n## Success Criteria\n1. Self-approval prevented\n2. Signatures verify correctly\n3. Conflict resolution works per config\n4. Bulk approve enforces same-tier\n5. Different-model tracking works","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-13T18:12:34.460914372-06:00","updated_at":"2025-12-13T18:12:34.460914372-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-jrn","depends_on_id":"simultaneous_launch_button-3s8","type":"blocks","created_at":"2025-12-13T18:12:34.462563685-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-jrn.1","content_hash":"26a663c6c4e7c8c10455e5c0a62df604dc99108f31851fbb3a152487ac378bb5","title":"Implement SQLite CRUD operations for reviews","description":"## Task\nImplement database operations for review management.\n\n## Functions (internal/db/reviews.go)\n\n### Create\n- CreateReview(r *Review) error\n  - Generate UUID\n  - Validate no existing review for this (request_id, reviewer_session_id)\n  - Store signature and timestamp\n  - Set created_at\n\n### Read\n- GetReview(id string) (*Review, error)\n- ListReviewsForRequest(requestID string) ([]*Review, error)\n- CountReviewsByDecision(requestID string) (approvals int, rejections int, error)\n\n### Query\n- HasReviewerAlreadyReviewed(requestID, sessionID string) bool\n- IsRequestorSameAsReviewer(requestID, sessionID string) bool\n\n## Key Considerations\n- Unique constraint on (request_id, reviewer_session_id)\n- Foreign key to sessions for reviewer info\n- Signature stored but not validated at DB layer\n\n## Files\n- internal/db/reviews.go\n\n## Acceptance Criteria\n- [ ] Create prevents duplicate reviews\n- [ ] Counts accurate for approval tracking\n- [ ] Self-review detection works","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:19:06.837362579-06:00","updated_at":"2025-12-13T20:03:27.093916082-06:00","closed_at":"2025-12-13T20:03:27.093916082-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-jrn.1","depends_on_id":"simultaneous_launch_button-f5d.2","type":"blocks","created_at":"2025-12-13T18:19:06.838321846-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-jrn.2","content_hash":"882ebf5c68dc570694b893a907fcfe52baa1d68b53f0e01be0f9df2a28e96c2c","title":"Implement review core logic with signature verification","description":"## Task\nImplement the core logic for reviewing (approving/rejecting) requests.\n\n## Functions (internal/core/review.go)\n\n### SubmitReview(opts ReviewOptions) (*Review, error)\nOptions:\n- SessionID (required)\n- RequestID (required)\n- Decision (\"approve\" or \"reject\")\n- Responses (reason, effect, goal, safety responses)\n- Comments (optional)\n\nLogic:\n1. Get session (validate active)\n2. Get request (validate pending)\n3. Check not self-review (requestor != reviewer)\n4. Check not already reviewed by this session\n5. Check require_different_model (if set and requestor model == reviewer model):\n   - Allow if trusted_self_approve includes this agent\n   - Otherwise reject unless human or different model\n6. If trusted_self_approve agent, allow self-approval after delay\n7. Generate signature\n8. Create review in DB\n9. Check if decision changes request state:\n   - If reject â†’ request becomes REJECTED\n   - If approve â†’ count approvals vs min_approvals\n   - If enough approvals â†’ request becomes APPROVED\n10. Handle conflict resolution per config\n\n### GenerateSignature(sessionKey, requestID, decision, timestamp string) string\nHMAC-SHA256(session_key, request_id || decision || timestamp)\n\n### VerifySignature(sessionKey, requestID, decision, timestamp, signature string) bool\n- Verify HMAC matches\n- Check timestamp within 5 minutes of now\n\n## Conflict Resolution (configurable)\n- any_rejection_blocks (default): Any reject blocks\n- first_wins: First response wins\n- human_breaks_tie: Escalate to human\n\n## Trusted Self-Approve\nFrom [agents].trusted_self_approve config:\n- Listed agents can self-approve after trusted_self_approve_delay_seconds\n- Useful for special trusted agents like CI/CD\n\n## Files\n- internal/core/review.go\n- internal/core/signature.go\n\n## Acceptance Criteria\n- [ ] Self-review prevented (except trusted agents)\n- [ ] Different model check works if enabled\n- [ ] Duplicate review prevented\n- [ ] Signatures verified\n- [ ] Request state updated on sufficient approvals\n- [ ] Conflict resolution works per config\n- [ ] Trusted self-approve delay honored","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:19:22.195519336-06:00","updated_at":"2025-12-13T20:01:03.034148863-06:00","closed_at":"2025-12-13T20:01:03.034148863-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-jrn.2","depends_on_id":"simultaneous_launch_button-jrn.1","type":"blocks","created_at":"2025-12-13T18:19:22.196536541-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-jrn.2","depends_on_id":"simultaneous_launch_button-399.1","type":"blocks","created_at":"2025-12-13T18:19:22.197410599-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-jrn.3","content_hash":"c55d83b25aee4f969797f60ed9ba49a22fe9a90a59521bdcf3699d65ffb3fdbc","title":"Implement review CLI commands (review, approve, reject)","description":"## Task\nImplement CLI commands for reviewing requests.\n\n## Commands (internal/cli/review.go)\n\n### slb review \u003crequest-id\u003e\n- Shows full request details for review\n- Multiple IDs supported: slb review \u003cid1\u003e \u003cid2\u003e \u003cid3\u003e\n- JSON: full request object with justification, dry-run, attachments\n\n### slb approve \u003crequest-id\u003e\n- Flags: --session-id/-s (required)\n- Flags: --reason-response, --effect-response, --goal-response, --safety-response\n- Flags: --comment\n- Bulk approve: slb approve \u003cid1\u003e \u003cid2\u003e \u003cid3\u003e\n  - All must be same tier (safety check)\n  - --force-mixed-tiers to override\n- JSON: { request_id, status, decision, signature }\n\n### slb reject \u003crequest-id\u003e\n- Flags: --session-id/-s (required)\n- Flags: --reason (required for rejection)\n- Flags: --reason-response, --effect-response, --goal-response, --safety-response\n- JSON: { request_id, status, decision, reason }\n\n## Bulk Operations Safety\n- Bulk approve only allowed for same tier\n- Verify all requests are pending before proceeding\n- Atomic: all succeed or none (or best-effort with summary)\n\n## Error Cases\n- Self-review: \"Cannot review your own request\"\n- Already reviewed: \"You have already reviewed this request\"\n- Not pending: \"Request is not pending\"\n\n## Files\n- internal/cli/review.go\n- internal/cli/approve.go\n- internal/cli/reject.go\n\n## Acceptance Criteria\n- [ ] Review shows full details\n- [ ] Approve with responses works\n- [ ] Reject requires reason\n- [ ] Bulk operations enforce same-tier\n- [ ] Error messages are clear","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:19:38.17217539-06:00","updated_at":"2025-12-13T20:07:42.218005994-06:00","closed_at":"2025-12-13T20:07:42.218008669-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-jrn.3","depends_on_id":"simultaneous_launch_button-jrn.2","type":"blocks","created_at":"2025-12-13T18:19:38.173226719-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-jrn.3","depends_on_id":"simultaneous_launch_button-v0z.2","type":"blocks","created_at":"2025-12-13T18:19:38.182066074-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-kb5","content_hash":"95411933f809a810bbdc72b966fe0f569c7bc84fe19f0052e30bba97e15c6825","title":"EPIC: Command Execution System","description":"## Overview\nImplement the command execution system - actually running approved commands safely with proper logging.\n\n## Background \u0026 Rationale\nA critical v2.0.0 decision: **client-side execution**. The daemon is a NOTARY (verifies approvals) not an executor. Commands must run in the calling process's shell environment to inherit:\n- AWS_PROFILE, AWS_ACCESS_KEY_ID\n- KUBECONFIG\n- Activated virtualenvs\n- SSH_AUTH_SOCK\n- Database connection strings\n\n## Key Commands (from plan)\n- `slb execute \u003crequest-id\u003e [--timeout \u003cseconds\u003e] [--background]`\n- `slb emergency-execute \"\u003ccommand\u003e\" --reason \"...\" [--yes --ack \"\u003csha256\u003e\"]`\n- `slb rollback \u003crequest-id\u003e` (if rollback data captured)\n\n## Execution Gate Conditions (enforced at execute time)\n1. Request status is APPROVED\n2. approval_expires_at has not elapsed (30min default, 10min for CRITICAL)\n3. command_hash still matches (no mutation since approval)\n4. Current pattern policy doesn't raise required tier\n5. First successful executor wins (idempotent)\n\n## Key Features\n1. **Dry-Run Pre-flight**: For supported commands, run --dry-run first\n2. **Rollback Capture**: Optionally capture state before execution\n3. **Execution Logging**: stdout/stderr to .slb/logs/req-\u003cuuid\u003e.log\n4. **Exit Code Tracking**: Report back to DB\n5. **Timeout Handling**: Kill after configurable timeout\n\n## Dry-Run Support (from plan)\n- kubectl * â†’ --dry-run=client\n- terraform destroy â†’ terraform plan -destroy\n- rm â†’ show file listing\n- git reset --hard â†’ git diff HEAD..\u003ctarget\u003e\n\n## Files\n- internal/core/execute.go\n- internal/core/dryrun.go\n- internal/core/rollback.go\n- internal/cli/execute.go, emergency.go, rollback.go\n- internal/daemon/verifier.go (validates execution is allowed)\n\n## Success Criteria\n1. Commands inherit caller's environment\n2. Execution gate conditions enforced\n3. Dry-run works for supported commands\n4. Rollback capture works\n5. Logs captured correctly\n6. Emergency override logged extensively","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-13T18:12:53.182174218-06:00","updated_at":"2025-12-13T18:12:53.182174218-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-kb5","depends_on_id":"simultaneous_launch_button-jrn","type":"blocks","created_at":"2025-12-13T18:12:53.18374808-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-kb5.1","content_hash":"376daf481863cfe2b80b0917ab76e6d7793e71adb49f38ff1c79efb3bcadce15","title":"Implement command execution core logic","description":"## Task\nImplement the core logic for executing approved commands.\n\n## Key Design Decision (v2.0.0)\nClient-side execution! The command runs in the CALLER'S shell environment, not in the daemon. This is critical for inheriting:\n- AWS_PROFILE, AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY\n- KUBECONFIG\n- VIRTUAL_ENV, PATH modifications\n- SSH_AUTH_SOCK\n- Database connection strings\n\n## Functions (internal/core/execute.go)\n\n### ExecuteApprovedRequest(opts ExecuteOptions) (*ExecutionResult, error)\nOptions:\n- RequestID (required)\n- SessionID (required for tracking)\n- Timeout (duration, default 5 min)\n- Background (bool)\n\nExecution Gate Conditions (all must pass):\n1. Request status is APPROVED\n2. approval_expires_at has not elapsed\n3. command_hash still matches (no mutation)\n4. Current pattern policy doesn't raise required tier\n5. First executor wins (idempotent)\n\nLogic:\n1. Validate all gate conditions\n2. Update status to EXECUTING\n3. Execute command in current shell environment\n4. Capture stdout/stderr to log file\n5. On completion, update status to EXECUTED/EXECUTION_FAILED\n6. Record exit code, duration\n7. Return result\n\n### RunCommand(spec *CommandSpec, timeout time.Duration) (*CommandResult, error)\n- Execute using exec.Command or shell\n- Stream output to terminal AND log file\n- Handle timeout with context\n- Return exit code, captured output\n\n## Files\n- internal/core/execute.go\n- internal/core/command.go\n\n## Acceptance Criteria\n- [ ] Gate conditions all checked\n- [ ] Command inherits caller's env\n- [ ] Output logged to file\n- [ ] Timeout kills command\n- [ ] Status updated on completion","status":"closed","priority":1,"issue_type":"task","assignee":"BlueBear","created_at":"2025-12-13T18:19:55.870469078-06:00","updated_at":"2025-12-13T20:12:37.713908484-06:00","closed_at":"2025-12-13T20:12:37.713912592-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-kb5.1","depends_on_id":"simultaneous_launch_button-3s8.1","type":"blocks","created_at":"2025-12-13T18:19:55.871476545-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-kb5.1","depends_on_id":"simultaneous_launch_button-jrn.2","type":"blocks","created_at":"2025-12-13T18:19:55.872330846-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-kb5.2","content_hash":"e56ed349c80b5cc1c4663fcc9e99c13fc6234824c0eb7d9d4b25bb27c5f6a2c3","title":"Implement execute CLI commands","description":"## Task\nImplement CLI commands for executing approved requests.\n\n## Commands\n\n### slb execute \u003crequest-id\u003e\n- Flags: --session-id/-s\n- Flags: --timeout (seconds, default 300)\n- Flags: --background (don't wait, return PID)\n- Validates gate conditions\n- Executes in caller's environment\n- JSON: { exit_code, duration_ms, log_path }\n\n### slb emergency-execute \"\u003ccommand\u003e\"\n- Human override that bypasses approval\n- Flags: --reason (required)\n- Flags: --capture-rollback\n- Flags: --yes (skip interactive confirmation)\n- Flags: --ack \"\u003csha256(command)\u003e\" (required with --yes)\n- Requires interactive confirmation OR --yes --ack\n- Logs extensively for audit\n- JSON: { exit_code, logged_at, reason }\n\n### slb rollback \u003crequest-id\u003e\n- Requires rollback data was captured\n- Restores captured state\n- JSON: { request_id, rolled_back_at }\n\n## Error Cases\n- Not approved: \"Request is not in approved state\"\n- Approval expired: \"Approval has expired, please re-request\"\n- Hash mismatch: \"Command was modified since approval\"\n- Already executed: \"Request has already been executed\"\n\n## Files\n- internal/cli/execute.go\n- internal/cli/emergency.go\n- internal/cli/rollback.go\n\n## Acceptance Criteria\n- [ ] Execute validates all gate conditions\n- [ ] Command runs in caller's environment\n- [ ] Emergency requires confirmation or --yes --ack\n- [ ] Rollback restores captured state\n- [ ] All output is JSON compatible","status":"in_progress","priority":1,"issue_type":"task","assignee":"BlueBear","created_at":"2025-12-13T18:20:11.282654838-06:00","updated_at":"2025-12-13T20:13:24.849372072-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-kb5.2","depends_on_id":"simultaneous_launch_button-kb5.1","type":"blocks","created_at":"2025-12-13T18:20:11.283601211-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-kb5.2","depends_on_id":"simultaneous_launch_button-v0z.2","type":"blocks","created_at":"2025-12-13T18:20:11.284485618-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-kb5.3","content_hash":"6ec812e349a8479bc6b1b5b7b94ba34f2272584c907f14c1f43cc32b4531c873","title":"Implement dry-run pre-flight for supported commands","description":"## Task\nImplement dry-run pre-flight checks for commands that support it.\n\n## Supported Commands (from plan)\n\n### kubectl\n- Original: kubectl delete deployment foo\n- Dry-run: kubectl delete deployment foo --dry-run=client\n- Output: Shows what would be deleted\n\n### terraform\n- Original: terraform destroy\n- Dry-run: terraform plan -destroy\n- Output: Shows resources that would be destroyed\n\n### rm\n- Original: rm -rf ./build\n- Dry-run: ls -la ./build (show what would be removed)\n- Output: File listing with sizes\n\n### git reset\n- Original: git reset --hard HEAD~5\n- Dry-run: git diff HEAD~5..HEAD\n- Output: Shows commits that would be lost\n\n### helm\n- Original: helm uninstall myrelease\n- Dry-run: helm get manifest myrelease\n- Output: Shows resources that would be removed\n\n## Functions (internal/core/dryrun.go)\n\n### RunDryRun(spec *CommandSpec) (*DryRunResult, error)\n1. Detect command type from spec\n2. Generate dry-run variant\n3. Execute dry-run command\n4. Capture and format output\n5. Return result\n\n### GetDryRunCommand(cmd string) (string, bool)\n- Return dry-run variant if supported\n- Return false if no dry-run available\n\n## Files\n- internal/core/dryrun.go\n\n## Acceptance Criteria\n- [ ] kubectl --dry-run works\n- [ ] terraform plan -destroy works\n- [ ] rm shows file listing\n- [ ] git shows diff\n- [ ] Graceful fallback for unsupported","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:25:05.04879799-06:00","updated_at":"2025-12-13T18:25:05.04879799-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-kb5.3","depends_on_id":"simultaneous_launch_button-kb5.1","type":"blocks","created_at":"2025-12-13T18:25:05.049776051-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-kb5.4","content_hash":"0ebdf94918b58ea5696dcdc898831b9f1686a2bf39ac8d13d3cbd6b11cbc608e","title":"Implement rollback state capture","description":"## Task\nImplement optional rollback state capture before destructive operations.\n\n## What to Capture\n\n### File System (rm)\n- Create tarball of affected paths\n- Store in .slb/rollback/req-\u003cid\u003e.tar.gz\n- Include metadata (permissions, timestamps)\n\n### Git\n- Store current HEAD commit hash\n- Capture stash of uncommitted changes\n- Store branch name\n\n### Kubernetes\n- kubectl get \u003cresource\u003e -o yaml before delete\n- Store in .slb/rollback/req-\u003cid\u003e.yaml\n\n### Database (if applicable)\n- pg_dump / mysqldump of affected tables\n- Store schema + data\n\n## Functions (internal/core/rollback.go)\n\n### CaptureRollbackState(req *Request) (*RollbackData, error)\n1. Detect command type\n2. Execute capture strategy\n3. Store data in .slb/rollback/\n4. Return metadata\n\n### RestoreRollbackState(data *RollbackData) error\n1. Validate rollback data exists\n2. Execute restore strategy\n3. Verify restoration\n4. Log outcome\n\n## Configuration\n[general]\nenable_rollback_capture = true\n\n## Storage\n- .slb/rollback/req-\u003cuuid\u003e/\n  - metadata.json\n  - files.tar.gz\n  - manifest.yaml\n  - etc.\n\n## Files\n- internal/core/rollback.go\n\n## Acceptance Criteria\n- [ ] File capture creates valid tarball\n- [ ] Git state captured correctly\n- [ ] Kubernetes manifests captured\n- [ ] Restore works\n- [ ] Storage cleaned up after retention","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:25:19.447633852-06:00","updated_at":"2025-12-13T18:25:19.447633852-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-kb5.4","depends_on_id":"simultaneous_launch_button-kb5.1","type":"blocks","created_at":"2025-12-13T18:25:19.448557502-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-qr8","content_hash":"ef509b6c7980b33adc3005dce58e1fce3e9af7d7ef0dc387f90fa5884869974a","title":"EPIC: Pattern Matching \u0026 Risk Classification","description":"## Overview\nImplement the three-tier risk classification system that determines which commands need approval and at what level.\n\n## Background \u0026 Rationale\nNot all dangerous commands are equally dangerous. The plan defines three tiers:\n- CRITICAL: Catastrophic, irreversible (2+ approvals, human notification)\n- DANGEROUS: Significant, recoverable with effort (1 approval)\n- CAUTION: Annoying if wrong, easily fixed (auto-approved after 30s)\n\nPlus a SAFE tier for commands that skip review entirely.\n\n## Key Features (from plan)\n1. **Pattern Matching**: Regex patterns per tier, case-insensitive\n2. **Command Normalization**: Strip sudo/env wrappers, detect compound commands\n3. **Path Resolution**: Expand relative paths to absolute for safety checks\n4. **Pattern Precedence**: SAFE â†’ CRITICAL â†’ DANGEROUS â†’ CAUTION\n5. **Agent Pattern Management**: Agents can ADD patterns (making things safer) but CANNOT remove\n6. **Dynamic Quorum**: If fewer agents available, adjust required approvals\n\n## Key Commands\n- `slb patterns list [--tier \u003ctier\u003e]` â†’ list patterns\n- `slb patterns test \"\u003ccommand\u003e\"` / `slb check \"\u003ccommand\u003e\"` â†’ show tier\n- `slb patterns add --tier \u003ctier\u003e \"\u003cpattern\u003e\" --reason \"...\"` â†’ agents can add\n- `slb patterns request-removal \"\u003cpattern\u003e\"` â†’ creates pending removal request\n- `slb patterns suggest --tier \u003ctier\u003e \"\u003cpattern\u003e\"` â†’ propose for human review\n\n## Files\n- internal/core/patterns.go (matching logic)\n- internal/config/patterns.go (default patterns)\n- internal/cli/patterns.go\n- internal/db/pattern_changes.go, custom_patterns.go\n\n## Default Pattern Categories\n- File System: rm -rf, chmod -R, chown -R\n- Git: reset --hard, clean -fd, push --force\n- Kubernetes: delete node/namespace/pv/pvc\n- Databases: DROP DATABASE/SCHEMA/TABLE, DELETE without WHERE\n- Cloud: terraform destroy, aws terminate-instances\n- Containers: docker system prune -a\n\n## Success Criteria\n1. Commands correctly classified into tiers\n2. Normalization handles sudo, env, compound commands\n3. Agents can add but not remove patterns\n4. Pattern test returns JSON with needs_approval, tier, min_approvals","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-13T18:11:57.291380377-06:00","updated_at":"2025-12-13T18:11:57.291380377-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-qr8","depends_on_id":"simultaneous_launch_button-f5d","type":"blocks","created_at":"2025-12-13T18:11:57.29266506-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-qr8.1","content_hash":"a5ed0fb46ca799f0dd37ffeeed7b1345b2fee6c052cf601897dceb2c19c36daf","title":"Implement pattern matching engine with command normalization","description":"## Task\nImplement the pattern matching engine that classifies commands into risk tiers.\n\n## Core Functions (internal/core/patterns.go)\n\n### ClassifyCommand(cmd string, cwd string) (RiskTier, *MatchResult)\n- Normalize command\n- Check tiers in order: SAFE â†’ CRITICAL â†’ DANGEROUS â†’ CAUTION\n- Return tier and match details\n\n### NormalizeCommand(cmd string) (*NormalizedCommand, error)\n- Parse with shell-aware tokenizer\n- Extract primary command from wrappers: sudo, doas, env, command, builtin, time, nice, ionice, nohup\n- Detect compound commands (;, \u0026\u0026, ||, |, subshells)\n- If any segment matches tier, whole command is at least that tier\n- If parsing fails, fall back to raw regex and upgrade tier by one step\n\n### MatchPattern(pattern, cmd string) bool\n- Regex matching, case-insensitive by default\n- Handle special characters\n\n### ResolvePathsInCommand(cmd, cwd string) string\n- Expand relative paths (./,../) to absolute\n- Used for path-aware patterns\n\n## Pattern Precedence\n1. Check SAFE patterns â†’ skip review entirely\n2. Check CRITICAL â†’ highest risk\n3. Check DANGEROUS\n4. Check CAUTION\n5. No match â†’ allowed without review\n\n## Match Result\n- Tier\n- MatchedPattern\n- MinApprovals\n- NeedsApproval (bool)\n\n## Files\n- internal/core/patterns.go\n- internal/core/normalize.go\n\n## Acceptance Criteria\n- [ ] Commands correctly classified\n- [ ] sudo/env wrappers stripped\n- [ ] Compound commands detected\n- [ ] Paths resolved correctly\n- [ ] Case-insensitive matching","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T18:17:09.132220861-06:00","updated_at":"2025-12-13T19:39:45.690271534-06:00","closed_at":"2025-12-13T19:39:45.690271534-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-qr8.1","depends_on_id":"simultaneous_launch_button-f5d.1","type":"blocks","created_at":"2025-12-13T18:31:34.904807286-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-qr8.2","content_hash":"2c9dfc5d8d592835573ae38884c0116112f484e2698979430d451e53b352bb2e","title":"Define default dangerous patterns","description":"## Task\nDefine the default pattern sets for each risk tier as specified in the plan.\n\n## Pattern Categories (internal/config/patterns.go)\n\n### CRITICAL (2+ approvals required)\nFile System:\n- ^rm\\s+-rf\\s+/(?!tmp) - rm -rf / (but not /tmp)\n- ^rm\\s+-rf\\s+~ - rm -rf ~\n\nDatabases:\n- DROP\\s+DATABASE\n- DROP\\s+SCHEMA\n- TRUNCATE\\s+TABLE\n- DELETE\\s+FROM\\s+[\\w.`\"[\\]]+\\s*($|;|--|/\\*) - DELETE without WHERE\n\nKubernetes:\n- ^kubectl\\s+delete\\s+(node|namespace|pv|pvc)\n- ^helm\\s+uninstall.*--all\n\nCloud:\n- ^terraform\\s+destroy(?!.*-target) - terraform destroy without -target\n- ^aws\\s+.*terminate-instances\n- ^gcloud.*delete.*--quiet\n\nGit:\n- ^git\\s+push.*--force(?!-with-lease) - force push (not with-lease)\n\nContainers:\n- ^docker\\s+system\\s+prune\\s+-a\n\n### DANGEROUS (1 approval required)\n- ^rm\\s+-rf, ^rm\\s+-r\n- ^git\\s+reset\\s+--hard, ^git\\s+clean\\s+-fd\n- ^git\\s+push.*--force-with-lease\n- ^kubectl\\s+delete\n- ^helm\\s+uninstall\n- ^docker\\s+rm, ^docker\\s+rmi\n- ^terraform\\s+destroy.*-target\n- ^terraform\\s+state\\s+rm\n- DROP\\s+TABLE\n- DELETE\\s+FROM.*WHERE\n- ^chmod\\s+-R, ^chown\\s+-R\n\n### CAUTION (auto-approved after 30s)\n- ^rm\\s+[^-] - rm without flags\n- ^git\\s+stash\\s+drop\n- ^git\\s+branch\\s+-[dD]\n- ^npm\\s+uninstall, ^pip\\s+uninstall, ^cargo\\s+remove\n\n### SAFE (skip review)\n- ^rm\\s+.*\\.log$, ^rm\\s+.*\\.tmp$, ^rm\\s+.*\\.bak$\n- ^git\\s+stash(?!.*drop)\n- ^kubectl\\s+delete\\s+pod\n- ^npm\\s+cache\\s+clean\n\n## Files\n- internal/config/patterns.go\n\n## Acceptance Criteria\n- [ ] All default patterns defined\n- [ ] Patterns compile as valid regex\n- [ ] Tier configuration includes min_approvals\n- [ ] Patterns documented with comments","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:17:28.276069017-06:00","updated_at":"2025-12-13T19:41:57.821202644-06:00","closed_at":"2025-12-13T19:41:57.821202644-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-qr8.2","depends_on_id":"simultaneous_launch_button-qr8.1","type":"blocks","created_at":"2025-12-13T18:17:28.277216995-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-qr8.3","content_hash":"8b8471d65fa1ae5c5f1fcc23834ffd8b2fe52ab283d07a1bc536cd16da910d25","title":"Implement pattern CLI commands","description":"## Task\nImplement CLI commands for pattern management.\n\n## Commands (internal/cli/patterns.go)\n\n### slb patterns list\n- Flags: --tier\n- Lists all patterns grouped by tier\n- JSON: { critical: [], dangerous: [], caution: [], safe: [] }\n\n### slb patterns test \"\u003ccommand\u003e\"\n- Alias: slb check \"\u003ccommand\u003e\"\n- Flags: --exit-code (return non-zero if approval needed)\n- Shows which tier command matches\n- JSON: { needs_approval, tier, min_approvals, matched_pattern }\n\n### slb patterns add\n- Flags: --tier (required), --reason\n- Positional: pattern\n- Agents CAN add patterns freely\n- Records in pattern_changes and custom_patterns tables\n- JSON: { pattern, tier, added_by, added_at }\n\n### slb patterns remove\n- BLOCKED for agents\n- Returns exit code 1 with JSON error\n- Message: \"Pattern removal requires human approval. Use slb tui.\"\n\n### slb patterns request-removal\n- Flags: --reason (required)\n- Positional: pattern\n- Creates pending removal request for human review\n- JSON: { request_id, pattern, status: \"pending\" }\n\n### slb patterns suggest\n- Flags: --tier, --reason\n- Like add but marks as \"suggested\" for human review\n- Human can promote or dismiss in TUI\n\n## Exit Codes\n- 0: No approval needed (or pattern added successfully)\n- 1: Approval needed (for --exit-code), or error\n- Exit code used by Claude Code hooks\n\n## Files\n- internal/cli/patterns.go\n\n## Acceptance Criteria\n- [ ] patterns test correctly identifies tier\n- [ ] patterns add works for agents\n- [ ] patterns remove blocked for agents\n- [ ] --exit-code flag works for hooks integration","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:17:46.79971591-06:00","updated_at":"2025-12-13T19:57:56.092395921-06:00","closed_at":"2025-12-13T19:57:56.092395921-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-qr8.3","depends_on_id":"simultaneous_launch_button-qr8.1","type":"blocks","created_at":"2025-12-13T18:17:46.800746821-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-qr8.3","depends_on_id":"simultaneous_launch_button-qr8.2","type":"blocks","created_at":"2025-12-13T18:17:46.801681943-06:00","created_by":"daemon"},{"issue_id":"simultaneous_launch_button-qr8.3","depends_on_id":"simultaneous_launch_button-v0z.2","type":"blocks","created_at":"2025-12-13T18:17:46.802573944-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-rjs","content_hash":"f42e408d61079530cb609a69a77b6f29539b50510c32354c77baab0cbd828518","title":"Implement different-model requirement timeout escalation","description":"## Task\nImplement handling when require_different_model is set but no different-model reviewer is available.\n\n## Background (Edge Case 9)\nWhen require_different_model = true, but no agent with a different model is active, the request should escalate after a timeout.\n\n## Configuration\n[general]\nrequire_different_model = false  # Optional setting\ndifferent_model_timeout = 300    # Escalate after 5 min\n\n## Logic\n1. If require_different_model set on request\n2. Check active sessions for different models\n3. If none available, start timeout countdown\n4. After timeout: escalate to human with message\n\n## TUI Display\nâš ï¸ Requires different model (requestor: opus-4.5)\nAvailable reviewers: GreenLake (opus-4.5) âŒ same model\n\n## Files\n- internal/core/review.go\n- internal/daemon/timeout.go\n- internal/tui/request/detail.go\n\n## Acceptance Criteria\n- [ ] Different model requirement enforced\n- [ ] Timeout triggers escalation\n- [ ] Clear messaging in TUI\n- [ ] Human can still approve","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:48:37.958377893-06:00","updated_at":"2025-12-13T18:48:37.958377893-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-rjs","depends_on_id":"simultaneous_launch_button-jrn.2","type":"blocks","created_at":"2025-12-13T18:48:37.960547554-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-tzt","content_hash":"55f332a759e213c7082c005be2757f2e3d55c1630c0e0233a43de1d1fa9a8b91","title":"Implement analytics/learning mode with execution outcomes","description":"## Task\nImplement the analytics and learning features using execution_outcomes table.\n\n## Background (from Creative Addition #7)\nTrack historical patterns to surface insights:\n- Which commands get approved vs rejected\n- Which approved commands caused subsequent problems\n- Which agents have high rejection rates\n- Time-to-approval metrics\n\n## execution_outcomes Table (already in schema)\n- request_id\n- caused_problems (bool)\n- problem_description\n- human_rating (1-5)\n- human_notes\n\n## Features\n1. After execution, prompt for outcome feedback (optional)\n2. CLI command: slb outcome \u003crequest-id\u003e --problems --description '...'\n3. Dashboard stats panel showing metrics\n4. Suggest pattern refinements based on history\n\n## Files\n- internal/db/outcomes.go\n- internal/cli/outcome.go\n- internal/tui/dashboard/stats.go (enhance)\n\n## Acceptance Criteria\n- [ ] Outcomes can be recorded\n- [ ] Stats calculated correctly\n- [ ] TUI shows metrics\n- [ ] Pattern suggestions generated","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:48:25.021142673-06:00","updated_at":"2025-12-13T18:48:25.021142673-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-tzt","depends_on_id":"simultaneous_launch_button-kb5.1","type":"blocks","created_at":"2025-12-13T18:48:25.023321712-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-v0z","content_hash":"9b0a7e3b906cd5f037c519d0ed7b228359390859305c1675b0670f7e4c2248c3","title":"EPIC: Project Foundation \u0026 Build Infrastructure","description":"## Overview\nEstablish the foundational Go project structure following the NTM-proven architecture. This epic covers the initial setup that all other work depends on.\n\n## Background \u0026 Rationale\nThe plan specifies Go 1.25 with the Charmbracelet ecosystem (Bubble Tea, Bubbles, Lip Gloss, Glamour). We're using modernc.org/sqlite (pure Go, no cgo) for simpler cross-compilation. This foundation must be rock-solid since everything else builds on it.\n\n## Key Decisions (from PLAN_TO_MAKE_SLB.md v2.0.0)\n- Single binary architecture (daemon is a subprocess, not separate binary)\n- Pure Go SQLite (no cgo dependency)\n- Charmbracelet ecosystem for TUI excellence\n- GoReleaser for cross-platform distribution\n- CI/CD via GitHub Actions\n\n## Success Criteria\n1. `go build ./...` succeeds\n2. Project structure matches plan layout\n3. GoReleaser config produces Linux/macOS/Windows binaries\n4. CI pipeline runs lint, test, build\n\n## Files Created\n- go.mod, go.sum\n- cmd/slb/main.go\n- Makefile\n- .goreleaser.yaml\n- .github/workflows/ci.yml, release.yml\n- scripts/install.sh","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-13T18:11:04.39081558-06:00","updated_at":"2025-12-13T19:26:46.795848726-06:00","closed_at":"2025-12-13T19:26:46.795848726-06:00","source_repo":"."}
{"id":"simultaneous_launch_button-v0z.1","content_hash":"3debcfe75f0452e25218a51cf164344706f57b61947ccd96c087afda036282a1","title":"Initialize Go module and project structure","description":"## Task\nCreate the Go module and directory structure as specified in the plan.\n\n## Implementation Details\n\n### go.mod\nmodule github.com/Dicklesworthstone/slb\ngo 1.25\n\n### Core Dependencies (from plan)\n- github.com/charmbracelet/bubbletea v0.25.0\n- github.com/charmbracelet/bubbles v0.18.0\n- github.com/charmbracelet/lipgloss v1.1.1\n- github.com/charmbracelet/glamour v0.10.0\n- github.com/charmbracelet/huh v0.3.0\n- github.com/charmbracelet/log v0.3.1\n- github.com/spf13/cobra v1.8.0\n- github.com/spf13/viper v1.18.0\n- modernc.org/sqlite v1.29.0\n- github.com/fsnotify/fsnotify v1.9.0\n- github.com/google/uuid v1.6.0\n- github.com/samber/lo v1.39.0\n- github.com/BurntSushi/toml v1.3.2\n- github.com/jedib0t/go-pretty/v6 v6.5.0\n\n### Directory Structure\n- cmd/slb/main.go\n- internal/cli/\n- internal/daemon/\n- internal/db/\n- internal/core/\n- internal/tui/\n- internal/git/\n- internal/config/\n- internal/integrations/\n- internal/output/\n- internal/utils/\n\n## Acceptance Criteria\n- [ ] `go mod init` succeeds\n- [ ] All dependencies in go.sum\n- [ ] `go build ./...` compiles (with stubs)\n- [ ] Directory structure matches plan","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T18:15:32.279833442-06:00","updated_at":"2025-12-13T19:22:33.160404689-06:00","closed_at":"2025-12-13T19:22:33.160404689-06:00","source_repo":"."}
{"id":"simultaneous_launch_button-v0z.2","content_hash":"0c29dd4171706f8934f96536062588199046d5a4437afc7cafafeaefa3026afa","title":"Create entry point main.go with Cobra root command","description":"## Task\nCreate cmd/slb/main.go and internal/cli/root.go with the Cobra root command.\n\n## Implementation Details\n\n### cmd/slb/main.go\nSimple entry point that calls cli.Execute().\n\n### internal/cli/root.go\n- Root command with global flags: --json, --db, --actor\n- Short flag aliases: -j/--json, -s/--session-id, -C/--project\n- Quick reference card when no subcommand (using lipgloss)\n- Colorized help text\n\n### Quick Reference Card (from plan)\nWhen `slb` is run with no arguments, display a beautiful box with:\n- Setup instructions\n- Requestor workflow\n- Reviewer workflow\n- Tier legend\n- Flag reference\n\nUse Catppuccin Mocha colors:\n- Mauve (#cba6f7) for title\n- Blue (#89b4fa) for section headers\n- Green (#a6e3a1) for commands\n- Yellow (#f9e2af) for flags\n- Red (#f38ba8) for CRITICAL tier\n- Peach (#fab387) for DANGEROUS tier\n\n## Files\n- cmd/slb/main.go\n- internal/cli/root.go\n- internal/cli/help.go\n\n## Acceptance Criteria\n- [ ] `slb` shows colorful quick reference card\n- [ ] `slb --help` shows command list\n- [ ] `slb --version` shows version info\n- [ ] Global flags work","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-13T18:15:47.045127617-06:00","updated_at":"2025-12-13T19:23:57.730633704-06:00","closed_at":"2025-12-13T19:23:57.730633704-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-v0z.2","depends_on_id":"simultaneous_launch_button-v0z.1","type":"blocks","created_at":"2025-12-13T18:15:47.046140875-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-v0z.3","content_hash":"c0a0c68ed74d24b07190f6bc728623bd4cb63ee3f8d0e2a2e87919f2952694d7","title":"Create Makefile and CI/CD GitHub Actions workflows","description":"## Task\nCreate build infrastructure: Makefile and GitHub Actions workflows.\n\n## Makefile Targets\n\n### Build\n- make build: Build slb binary\n- make build-all: Build for all platforms\n- make install: Install to /usr/local/bin\n\n### Development\n- make dev: Build with race detector\n- make run: Build and run with args\n- make watch: Watch files and rebuild\n\n### Testing\n- make test: Run all tests\n- make test-unit: Run unit tests only\n- make test-integration: Run integration tests\n- make test-coverage: Generate coverage report\n\n### Quality\n- make lint: Run golangci-lint\n- make fmt: Format code\n- make vet: Run go vet\n- make check: Run all checks (lint, vet, test)\n\n### Release\n- make release: Run goreleaser\n- make snapshot: Build snapshot (no publish)\n\n### Cleanup\n- make clean: Remove build artifacts\n\n## GitHub Actions\n\n### .github/workflows/ci.yml\nTriggered on: push to main, pull requests\n\nJobs:\n1. lint: Run golangci-lint\n2. test: Run tests on Linux, macOS, Windows\n3. build: Build binaries\n\n### .github/workflows/release.yml\nTriggered on: tag push (v*)\n\nJobs:\n1. goreleaser: Build and publish release\n\n### .github/workflows/codeql.yml (optional)\nSecurity analysis\n\n## Files\n- Makefile\n- .github/workflows/ci.yml\n- .github/workflows/release.yml\n- .golangci.yml (linter config)\n\n## Acceptance Criteria\n- [ ] make build works\n- [ ] make test runs all tests\n- [ ] make lint passes\n- [ ] CI runs on PRs\n- [ ] Release workflow triggered by tags","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:34:14.947729484-06:00","updated_at":"2025-12-13T19:25:50.874665375-06:00","closed_at":"2025-12-13T19:25:50.874665375-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-v0z.3","depends_on_id":"simultaneous_launch_button-v0z.1","type":"blocks","created_at":"2025-12-13T18:34:14.948696435-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-v0z.4","content_hash":"20ea1cb6adb621dfe5b4ae5a06e8eddc5baef4bcdc5d4274275eb67b5d369045","title":"Implement structured logging infrastructure","description":"## Task\nSet up structured logging using charmbracelet/log.\n\n## Background\nThe plan specifies charmbracelet/log for consistent, beautiful logging. Logs should:\n- Be structured (key-value pairs)\n- Be colorized in terminal\n- Support log levels\n- Write to file when daemon mode\n\n## Functions (internal/utils/log.go)\n\n### InitLogger(opts LoggerOptions) *log.Logger\nOptions:\n- Level: debug, info, warn, error\n- Output: os.Stderr or file\n- Prefix: component name\n- TimeFormat: RFC3339\n\n### Log Levels\n- Debug: Detailed tracing (hidden in production)\n- Info: Normal operations\n- Warn: Recoverable issues\n- Error: Failures requiring attention\n\n## Usage Patterns\n```go\nlog.Info(\"Request created\", \n    \"request_id\", req.ID,\n    \"command\", req.Command.Raw,\n    \"tier\", req.RiskTier)\n\nlog.Warn(\"Daemon not running, using fallback\")\n\nlog.Error(\"Execution failed\",\n    \"error\", err,\n    \"request_id\", req.ID)\n```\n\n## Log Destinations\n- CLI commands: stderr (human-readable)\n- Daemon: ~/.slb/daemon.log (structured)\n- Per-request: .slb/logs/req-\u003cid\u003e.log\n\n## Configuration\n[daemon]\nlog_level = \"info\"\n\nSLB_LOG_LEVEL=debug environment override\n\n## Files\n- internal/utils/log.go\n\n## Acceptance Criteria\n- [ ] Logger initializes correctly\n- [ ] Log levels respected\n- [ ] Colorized output in terminal\n- [ ] File logging for daemon\n- [ ] Consistent structure across codebase","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:34:31.75053324-06:00","updated_at":"2025-12-13T19:26:32.276910662-06:00","closed_at":"2025-12-13T19:26:32.276910662-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-v0z.4","depends_on_id":"simultaneous_launch_button-v0z.1","type":"blocks","created_at":"2025-12-13T18:34:31.75141888-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-xdg","content_hash":"06dd6f8f5ce62bf4838329c408feb145b0362bd1e73ed64f6797fdf68d05e2f9","title":"Implement session garbage collection (slb session gc)","description":"## Task\nImplement session garbage collection to clean up stale sessions.\n\n## Background (from Edge Case 4)\nAgents can crash without ending their session. Need to detect and clean up stale sessions.\n\n## Command: slb session gc\n- Find sessions where last_active_at \u003c now - threshold (default 30 min)\n- End these sessions automatically\n- Report what was cleaned up\n\n## Options\n- --dry-run: Show what would be cleaned\n- --threshold \u003cduration\u003e: Override inactivity threshold\n- --force: Skip confirmation\n\n## Files\n- internal/cli/session.go (add gc subcommand)\n- internal/db/sessions.go (FindStaleSessions already exists)\n\n## Acceptance Criteria\n- [ ] Finds stale sessions\n- [ ] Ends them with proper audit trail\n- [ ] --dry-run shows preview\n- [ ] JSON output supported","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:47:52.300146943-06:00","updated_at":"2025-12-13T18:47:52.300146943-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-xdg","depends_on_id":"simultaneous_launch_button-399.1","type":"blocks","created_at":"2025-12-13T18:47:52.302301406-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-xsn","content_hash":"430a03a992ead4e4d3d86e58de129fb535fda08f6892ced9954cde03ec55b755","title":"Implement TUI pattern removal review panel","description":"## Task\nImplement the TUI view for human review of pattern removal requests.\n\n## Background\nAgents can request pattern removal with 'slb patterns request-removal', but only humans can approve. These pending requests should be visible in the TUI.\n\n## Features\n- Show pending pattern removal requests\n- Display pattern, tier, reason for removal\n- Approve/Reject actions\n- Filter by status\n\n## Integration\n- Show in dashboard sidebar or dedicated view\n- Navigate with keyboard shortcut 'm' for 'manage patterns'\n\n## Files\n- internal/tui/patterns/removal.go\n- internal/tui/dashboard/dashboard.go (add panel or nav option)\n\n## Acceptance Criteria\n- [ ] Pending removals visible\n- [ ] Human can approve/reject\n- [ ] Clear UI for pattern details\n- [ ] Keyboard navigation","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:48:13.142102845-06:00","updated_at":"2025-12-13T18:48:13.142102845-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-xsn","depends_on_id":"simultaneous_launch_button-2t9.1","type":"blocks","created_at":"2025-12-13T18:48:13.1442582-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-xva","content_hash":"b3dbbbe115a8b8936900b766a79699b12f3105e9e23b9dd16cd82a809f850265","title":"EPIC: Documentation \u0026 Distribution","description":"## Overview\nCreate documentation and set up distribution infrastructure: README, install scripts, GoReleaser, Homebrew.\n\n## Background \u0026 Rationale\nslb needs to be easy to install and use. The plan includes installation methods:\n- One-line curl install\n- go install\n- Homebrew (macOS/Linux)\n\nDocumentation includes:\n- README with quick start\n- AGENTS.md blurb for integration\n- --help text for all commands\n- Shell completions\n\n## Installation Methods (from plan)\n\n### One-Line Install\ncurl -fsSL https://raw.githubusercontent.com/Dicklesworthstone/slb/main/install.sh | bash\n\n### Go Install\ngo install github.com/Dicklesworthstone/slb/cmd/slb@latest\n\n### Homebrew\nbrew install dicklesworthstone/tap/slb\n\n## Shell Completions\n- zsh: eval \"$(slb completion zsh)\"\n- bash: eval \"$(slb completion bash)\"\n- fish: slb completion fish | source\n\nProvides:\n- Command and flag completion\n- Request ID completion from pending list\n- Session ID completion from active sessions\n\n## Documentation Files\n- README.md (installation, quick start, examples)\n- --help text (built into Cobra commands)\n- AGENTS.md blurb (copy-paste section for integration)\n- Quick reference card (slb with no args)\n\n## Distribution Infrastructure\n- .goreleaser.yaml\n- scripts/install.sh\n- .github/workflows/release.yml\n- Homebrew formula\n\n## Files\n- README.md\n- scripts/install.sh\n- .goreleaser.yaml\n- .github/workflows/release.yml\n\n## Success Criteria\n1. README is clear and complete\n2. Install script works on Linux/macOS\n3. GoReleaser produces binaries for all platforms\n4. Shell completions work\n5. AGENTS.md blurb is ready to copy","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-13T18:15:06.701589784-06:00","updated_at":"2025-12-13T18:15:06.701589784-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-xva","depends_on_id":"simultaneous_launch_button-7js","type":"blocks","created_at":"2025-12-13T18:15:06.703152795-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-xva.1","content_hash":"9794df90b4978a5315fb464f23729f90042c01d34417a983d3a2b7b7110326b0","title":"Create README and documentation","description":"## Task\nWrite comprehensive README and user documentation.\n\n## README Sections\n\n### Header\n- Project name and tagline\n- Badge row (build, go version, license)\n- Hero screenshot of TUI\n\n### Why slb?\n- Problem statement (agents make mistakes)\n- Two-person rule concept\n- What it prevents\n\n### Quick Start\n- Installation (one-liner)\n- Basic usage example\n- AGENTS.md integration snippet\n\n### Installation\n- curl | bash\n- go install\n- Homebrew\n- Binary downloads\n\n### Usage\n- Session management\n- Creating requests (slb run)\n- Reviewing requests\n- Approving/rejecting\n- Emergency override\n\n### Configuration\n- Config file locations\n- Key options\n- Example config.toml\n\n### Tier Reference\n- Table of tiers with examples\n- min_approvals per tier\n- Auto-approval for CAUTION\n\n### IDE Integration\n- Claude Code hooks\n- Cursor rules\n- Agent Mail\n\n### Troubleshooting\n- Common issues\n- FAQ\n\n### Contributing\n- Development setup\n- Running tests\n\n## AGENTS.md Blurb\nCopy-paste section for AGENTS.md (from plan).\n\n## Files\n- README.md\n- docs/configuration.md\n- docs/patterns.md\n\n## Acceptance Criteria\n- [ ] README is clear and complete\n- [ ] Quick start works\n- [ ] All commands documented\n- [ ] AGENTS.md blurb ready","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T18:26:49.76068652-06:00","updated_at":"2025-12-13T18:26:49.76068652-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-xva.1","depends_on_id":"simultaneous_launch_button-7wh","type":"blocks","created_at":"2025-12-13T18:26:49.761619729-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-xva.2","content_hash":"b8ef46cccf7c512acd04c3aeabe5a9bcb7954c1a5ee6a35fce913f0ad63158f0","title":"Configure GoReleaser for cross-platform builds","description":"## Task\nSet up GoReleaser for automated binary releases.\n\n## Platforms\n- Linux (amd64, arm64)\n- macOS (amd64, arm64 / Apple Silicon)\n- Windows (amd64)\n\n## .goreleaser.yaml\nproject_name: slb\nversion: 2\n\nbuilds:\n  - main: ./cmd/slb\n    binary: slb\n    env:\n      - CGO_ENABLED=0  # Pure Go SQLite\n    goos:\n      - linux\n      - darwin\n      - windows\n    goarch:\n      - amd64\n      - arm64\n    ldflags:\n      - -s -w\n      - -X main.Version={{.Version}}\n      - -X main.Commit={{.ShortCommit}}\n      - -X main.Date={{.Date}}\n\narchives:\n  - format: tar.gz\n    name_template: \"{{ .ProjectName }}_{{ .Os }}_{{ .Arch }}\"\n    format_overrides:\n      - goos: windows\n        format: zip\n\nchecksum:\n  name_template: checksums.txt\n\nchangelog:\n  use: github\n  sort: asc\n\nbrews:\n  - repository:\n      owner: Dicklesworthstone\n      name: homebrew-tap\n    folder: Formula\n    homepage: https://github.com/Dicklesworthstone/slb\n    description: Simultaneous Launch Button for AI agent command approval\n    install: |\n      bin.install \"slb\"\n\n## GitHub Actions (.github/workflows/release.yml)\n- Triggered on tag push (v*)\n- Runs GoReleaser\n- Publishes to GitHub Releases\n- Updates Homebrew tap\n\n## Files\n- .goreleaser.yaml\n- .github/workflows/release.yml\n\n## Acceptance Criteria\n- [ ] Builds for all platforms\n- [ ] Checksums generated\n- [ ] Homebrew formula updated\n- [ ] Release notes from changelog","status":"closed","priority":1,"issue_type":"task","assignee":"BrownCastle","created_at":"2025-12-13T18:27:04.180163575-06:00","updated_at":"2025-12-13T19:59:08.556451228-06:00","closed_at":"2025-12-13T19:59:08.556451228-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-xva.2","depends_on_id":"simultaneous_launch_button-v0z.1","type":"blocks","created_at":"2025-12-13T18:27:04.181143541-06:00","created_by":"daemon"}]}
{"id":"simultaneous_launch_button-xva.3","content_hash":"dfcc54e16c15a4591d54380dd6da9ae1af274d340356e7c2d020e0ed5ca63c2e","title":"Create install.sh script and shell completions","description":"## Task\nCreate one-line installer script and shell completion support.\n\n## install.sh\n#!/bin/bash\nset -euo pipefail\n\n# Detect platform\nOS=$(uname -s | tr '[:upper:]' '[:lower:]')\nARCH=$(uname -m)\n\n# Normalize arch\ncase $ARCH in\n  x86_64) ARCH=\"amd64\" ;;\n  aarch64|arm64) ARCH=\"arm64\" ;;\nesac\n\n# Get latest version\nVERSION=$(curl -sL https://api.github.com/repos/Dicklesworthstone/slb/releases/latest | grep tag_name | cut -d'\"' -f4)\n\n# Download\nDOWNLOAD_URL=\"https://github.com/Dicklesworthstone/slb/releases/download/${VERSION}/slb_${OS}_${ARCH}.tar.gz\"\ncurl -fsSL \"$DOWNLOAD_URL\" | tar -xz -C /tmp\n\n# Install\nsudo mv /tmp/slb /usr/local/bin/\necho \"slb ${VERSION} installed successfully!\"\necho \"Run 'slb' for quick reference.\"\n\n## Shell Completions\nCobra generates completions automatically:\n- slb completion zsh\n- slb completion bash\n- slb completion fish\n- slb completion powershell\n\nAdd to README:\n```bash\n# zsh (~/.zshrc)\neval \"$(slb completion zsh)\"\n\n# bash (~/.bashrc)\neval \"$(slb completion bash)\"\n\n# fish (~/.config/fish/config.fish)\nslb completion fish | source\n```\n\n## What Completions Provide\n- Command and subcommand names\n- Flag names and values\n- Request ID completion from pending list\n- Session ID completion from active sessions\n\n## Files\n- scripts/install.sh\n- internal/cli/completion.go (if customization needed)\n\n## Acceptance Criteria\n- [ ] Install script works on Linux/macOS\n- [ ] Detects correct platform\n- [ ] Installs to /usr/local/bin\n- [ ] Shell completions work\n- [ ] Dynamic request/session ID completion","status":"closed","priority":2,"issue_type":"task","assignee":"BrownCastle","created_at":"2025-12-13T18:27:34.668629149-06:00","updated_at":"2025-12-13T20:14:51.517796614-06:00","closed_at":"2025-12-13T20:14:51.517796614-06:00","source_repo":".","dependencies":[{"issue_id":"simultaneous_launch_button-xva.3","depends_on_id":"simultaneous_launch_button-xva.2","type":"blocks","created_at":"2025-12-13T18:27:34.669728777-06:00","created_by":"daemon"}]}
